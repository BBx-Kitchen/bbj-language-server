---
milestone: v1.2
audited: 2026-02-02T23:45:00Z
status: gaps_found
scores:
  requirements: 7/9
  phases: 2/2
  integration: 12/14 (2 broken by plugin ID mismatch)
  flows: 2/4 (2 broken or degraded by plugin ID mismatch)
gaps:
  requirements:
    - "RUN-04: macOS end-to-end testing requires human verification (not a code gap)"
    - "RUN-05: Windows end-to-end testing requires human verification (not a code gap)"
  integration:
    - "CRITICAL: Plugin ID mismatch — plugin.xml declares 'com.basis.bbj' but BbjLanguageServer.java:70 and BbjRunActionBase.java:231 hardcode 'com.basis.bbj.intellij'"
  flows:
    - "BUI/DWC run command flow: BROKEN — getWebBbjPath() returns null due to wrong plugin ID lookup"
    - "Language server startup flow: DEGRADED — resolveServerPath() primary path fails, falls back to classloader resource extraction (functional but creates temp file per startup)"
tech_debt: []
---

# Milestone v1.2 Audit Report

**Milestone:** v1.2 — Run Fixes & Marketplace
**Audited:** 2026-02-02
**Status:** GAPS FOUND (1 critical blocker)

## Executive Summary

Milestone v1.2 completed all planned work across 2 phases and 4 plans. Phase verifications passed at the code level. However, cross-phase integration checking revealed a **critical plugin ID mismatch** introduced when Phase 12 changed the plugin ID in plugin.xml without updating hardcoded references in Java source code. This breaks BUI/DWC run commands and degrades language server startup in production installs.

## Requirements Coverage

| Requirement | Phase | Status | Details |
|-------------|-------|--------|---------|
| RUN-01: BBj executable resolved from configured BBj Home | 11 | ✓ SATISFIED | java.nio.file.Files API handles symbolic links correctly |
| RUN-02: Run toolbar buttons visible in IntelliJ new UI | 11 | ✓ SATISFIED | ProjectViewPopupMenu submenu, MainToolBar removed |
| RUN-03: stdout/stderr captured in IntelliJ console | 11 | ✓ SATISFIED | ProcessAdapter captures stderr, routes to LS log window |
| RUN-04: Run commands work end-to-end on macOS | 11 | ? NEEDS HUMAN | Code verified, requires manual testing with BBj installation |
| RUN-05: Run commands work end-to-end on Windows | 11 | ? NEEDS HUMAN | Code verified, requires manual testing with BBj installation |
| MKT-01: Plugin has logo/icon | 12 | ✓ SATISFIED | pluginIcon.svg and pluginIcon_dark.svg (994 bytes each) |
| MKT-02: Complete description and metadata | 12 | ✓ SATISFIED | description.html with 9 verified features, vendor info |
| MKT-03: License text included | 12 | ✓ SATISFIED | MIT License + NOTICES in META-INF |
| MKT-04: Plugin verifier passes with no errors | 12 | ✓ SATISFIED | 0 compatibility errors (24 experimental API warnings from LSP4IJ) |

**Score: 7/9 requirements satisfied** (2 require human runtime testing)

## Phase Completion

| Phase | Plans | Verified | Status |
|-------|-------|----------|--------|
| 11. Run Command Fixes | 2/2 | Yes (human_needed for runtime) | ✓ Complete |
| 12. Marketplace Preparation | 2/2 | Yes (passed) | ✓ Complete |

**Score: 2/2 phases complete**

## Critical Integration Issue

### Plugin ID Mismatch (BLOCKER)

**Root cause:** Phase 12 commit `5add12d` changed the plugin ID from `com.basis.bbj.intellij` to `com.basis.bbj` in plugin.xml (per Marketplace naming rules) but did not update two hardcoded `PluginId.getId()` references in Java source code.

**Affected files:**

1. `bbj-intellij/src/main/java/com/basis/bbj/intellij/lsp/BbjLanguageServer.java` line 70:
   - `PluginId.getId("com.basis.bbj.intellij")` — should be `"com.basis.bbj"`
   - **Impact:** Language server path resolution primary path fails → falls back to classloader resource extraction (functional but creates temp file per startup)

2. `bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java` line 231:
   - `PluginId.getId("com.basis.bbj.intellij")` — should be `"com.basis.bbj"`
   - **Impact:** web.bbj path resolution fails → BUI/DWC run commands fail with "runner not found"

**Why not caught earlier:**
- Phase 11 verification checked code correctness before Phase 12 changed the plugin ID
- Phase 12 verification focused on marketplace metadata and verifier compliance
- Plugin verifier checks API compatibility, not runtime plugin ID string consistency
- Development sandbox (`runIde`) resolves plugins by directory name, masking the mismatch

**Why it matters:**
- GUI run is unaffected (doesn't use `getWebBbjPath()`)
- BUI/DWC run will always fail in production Marketplace installs
- LS startup works via fallback but is degraded (temp file creation)

## E2E Flow Verification

### Flow 1: Open .bbj file → Run as GUI → See Output

| Step | Status |
|------|--------|
| Plugin installs | ✓ |
| BBj Home auto-detected | ✓ |
| Open .bbj triggers LS start | ✓ (via fallback) |
| Right-click shows run actions | ✓ |
| GUI run validates and executes | ✓ |
| Stderr captured in console | ✓ |

**GUI Run Flow: PASS** (LS starts via fallback)

### Flow 2: Open .bbj file → Run as BUI/DWC → See Output

| Step | Status | Details |
|------|--------|---------|
| Context menu appears | ✓ | ProjectViewPopupMenu registered |
| Action enabled (LS started) | ✓ | LS starts via fallback |
| web.bbj path resolved | ✗ BROKEN | PluginId.getId() returns wrong ID → null plugin → null path |
| Command built and executed | ✗ BLOCKED | Cascading from above |

**BUI/DWC Run Flow: BROKEN**

### Flow 3: Build → Verify → Package for Marketplace

| Step | Status |
|------|--------|
| Gradle buildPlugin | ✓ |
| Plugin verifier passes | ✓ |
| ZIP contains all assets | ✓ |
| Runtime correctness | ✗ (plugin ID mismatch in compiled classes) |

**Build/Package Flow: PASS** (but produced artifact has bug)

### Flow 4: LS Startup in Production Install

| Step | Status | Details |
|------|--------|---------|
| Node.js resolved | ✓ | settings → detect → cached download → PATH |
| main.cjs resolved via PluginId | ✗ | Wrong plugin ID → null |
| main.cjs resolved via classloader fallback | ✓ | Extracts from classloader to temp file |
| LS starts, features work | ✓ | Via fallback path |

**LS Startup Flow: DEGRADED** (works but inefficient)

## Integration Wiring Summary

| Category | Count | Status |
|----------|-------|--------|
| Connected service/component wires | 12 | PASS |
| Plugin ID references (PluginId.getId) | 2 | FAIL (old ID) |
| Plugin.xml action registrations | All present | PASS |
| Description.html ↔ changeNotes | 9/9 features match | PASS |
| Description.html ↔ codebase | All 9 features verified | PASS |
| META-INF assets in distribution | All present | PASS |

## Documentation Discrepancy

**untilBuild value:**
- Phase 12-02 summary states: changed to `'242.*'`
- Actual code: `untilBuild = provider { null }` (no upper bound)
- **Impact:** None — actual value is more permissive, not a code defect

## Fix Required

**Complexity:** LOW (2-line fix + rebuild)

```java
// BbjLanguageServer.java line 70:
- PluginId pluginId = PluginId.getId("com.basis.bbj.intellij");
+ PluginId pluginId = PluginId.getId("com.basis.bbj");

// BbjRunActionBase.java line 231:
- com.intellij.openapi.extensions.PluginId.getId("com.basis.bbj.intellij")
+ com.intellij.openapi.extensions.PluginId.getId("com.basis.bbj")
```

After fix: rebuild plugin, re-run verifier, regenerate distribution ZIP.

## Tech Debt

None accumulated during v1.2. Pre-existing tech debt from earlier milestones:

- Structure View symbol kind differentiation (language server issue in bbj-node-kind.ts)
- EM credentials stored as plaintext in settings

## Deferred Items

- RUN-04/RUN-05: Human runtime testing on macOS and Windows (deferred to manual QA)
- Windows end-to-end testing (no Windows CI environment available)

---

_Audited: 2026-02-02_
_Auditor: Claude (gsd-audit-milestone)_
