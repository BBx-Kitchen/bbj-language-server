---
milestone: v3.7
audited: 2026-02-20T06:00:00Z
status: gaps_found
scores:
  requirements: 8/12
  phases: 3/4
  integration: 6/7
  flows: 3/4
gaps:
  requirements:
    - id: "CPL-05"
      status: "unsatisfied"
      phase: "53"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 53 has no directory, no plans, no VERIFICATION.md. Requirement not started."
    - id: "CPL-06"
      status: "unsatisfied"
      phase: "53"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 53 not started. Additionally, source label mismatch: parser emits 'BBj Compiler' but validator Phase 53 hook comment expects 'bbj-cpl' — latent bug that will break classification."
    - id: "CPL-07"
      status: "unsatisfied"
      phase: "53"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 53 not started. No bbj.compiler.trigger setting exists."
    - id: "CPL-08"
      status: "unsatisfied"
      phase: "53"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 53 not started. Partial ENOENT degradation in BBjCPLService but not E2E since compile() is never called from document lifecycle."
  integration:
    - from: "bbj-cpl-service.ts (Phase 52)"
      to: "bbj-document-builder.ts (Phase 53)"
      issue: "BBjCPLService.compile() registered in DI but never called from buildDocuments() — Phase 53 owns this connection"
      affected_requirements: ["CPL-05", "CPL-06", "CPL-07", "CPL-08"]
  flows:
    - name: "BBjCPL diagnostics shown in editor"
      breaks_at: "buildDocuments() does not call BBjCPLService.compile()"
      affected_requirements: ["CPL-05", "CPL-06", "CPL-07", "CPL-08"]
tech_debt:
  - phase: 50-diagnostic-noise-reduction
    items:
      - "Phase 50 VERIFICATION status is human_needed — 3 runtime behaviors need manual VS Code testing (suppression of cascading errors, warning/hint suppression, warnings reappear after fix)"
      - "Source label mismatch: bbj-cpl-parser.ts emits source 'BBj Compiler' but bbj-document-validator.ts Phase 53 comment expects 'bbj-cpl' — must reconcile before Phase 53 ships"
  - phase: 52-bbjcpl-foundation
    items:
      - "Plan specified AbortController; implementation correctly deviated to cancel flag + proc.kill() — documented deviation, not debt"
  - phase: global
    items:
      - "6 pre-existing test failures across classes.test.ts, completion-test.test.ts, imports.test.ts, validation.test.ts"
      - "14 pre-existing TODO/FIXME comments across 6 files"
---

# Milestone v3.7: Diagnostic Quality & BBjCPL Integration — Audit Report

**Audited:** 2026-02-20
**Status:** GAPS FOUND
**Score:** 8/12 requirements satisfied

---

## Requirements Coverage (3-Source Cross-Reference)

| REQ-ID | Description | Phase | VERIFICATION.md | REQUIREMENTS.md | Final Status |
|--------|-------------|-------|-----------------|-----------------|--------------|
| DIAG-01 | Suppress cascading linking errors on parse errors | 50 | SATISFIED | `[x]` | **satisfied** |
| DIAG-02 | Warnings/hints absent when hard errors present | 50 | SATISFIED | `[x]` | **satisfied** |
| OUTL-01 | Document symbols survive syntax errors | 51 | SATISFIED | `[x]` | **satisfied** |
| OUTL-02 | Methods before/after error visible in Structure View | 51 | SATISFIED | `[x]` | **satisfied** |
| CPL-01 | Discover BBjCPL output format via fixtures | 52 | SATISFIED | `[x]` | **satisfied** |
| CPL-02 | Invoke BBjCPL with bbj.home path and -N flag | 52 | SATISFIED | `[x]` | **satisfied** |
| CPL-03 | Parse stderr into LSP diagnostics with accurate lines | 52 | SATISFIED | `[x]` | **satisfied** |
| CPL-04 | Safe process management (abort, timeout, no orphans) | 52 | SATISFIED | `[x]` | **satisfied** |
| CPL-05 | BBjCPL diagnostics labeled "BBjCPL" | 53 | MISSING | `[ ]` | **unsatisfied** |
| CPL-06 | Diagnostic hierarchy — BBjCPL errors first | 53 | MISSING | `[ ]` | **unsatisfied** |
| CPL-07 | Configurable trigger setting | 53 | MISSING | `[ ]` | **unsatisfied** |
| CPL-08 | Graceful degradation when BBj not installed | 53 | MISSING | `[ ]` | **unsatisfied** |

**Orphaned requirements:** None — all 12 requirements in traceability table are assigned to phases.

---

## Phase Status

| Phase | Name | Plans | Status | VERIFICATION |
|-------|------|-------|--------|--------------|
| 50 | Diagnostic Noise Reduction | 2/2 | Complete | human_needed (runtime tests) |
| 51 | Outline Resilience | 1/1 | Complete | passed (5/5) |
| 52 | BBjCPL Foundation | 2/2 | Complete | passed (4/4) |
| 53 | BBjCPL Diagnostic Integration | 0/TBD | Not started | MISSING |

---

## Integration Check

### Cross-Phase Wiring

| From | To | Status |
|------|----|--------|
| Phase 50 validator → bbj-ws-manager.ts (startup) | setSuppressCascading/setMaxErrors | WIRED |
| Phase 50 validator → main.ts (live config) | setSuppressCascading/setMaxErrors | WIRED |
| Phase 50 validator → extension.ts (status bar) | getDiagnostics() heuristic | WIRED |
| Phase 51 symbol provider → bbj-module.ts | DocumentSymbolProvider registration | WIRED |
| Phase 52 parser → bbj-cpl-service.ts | parseBbjcplOutput import | WIRED |
| Phase 52 service → bbj-module.ts | compiler.BBjCPLService registration | WIRED |
| Phase 52 service → Phase 53 buildDocuments() | compile() caller | **UNWIRED** (Phase 53 gap) |

### Latent Bug: Source Label Mismatch

`bbj-cpl-parser.ts:57` sets `source: 'BBj Compiler'` but `bbj-document-validator.ts:43` Phase 53 hook comment expects `d.source === 'bbj-cpl'`. Phase 53 must reconcile — either change the parser source label or update the classifier to match `'BBj Compiler'`.

### E2E Flows

| Flow | Status | Notes |
|------|--------|-------|
| Diagnostic suppression on parse error | COMPLETE | DIAG-01, DIAG-02 |
| Outline survives syntax error | COMPLETE | OUTL-01, OUTL-02 |
| BBjCPL parser produces LSP diagnostics | COMPLETE (unit) | CPL-01, CPL-03 — test-only, no production trigger |
| BBjCPL diagnostics visible in editor | **BROKEN** | CPL-05-08 — Phase 53 not started |

---

## Tech Debt

### Phase 50
- VERIFICATION status `human_needed` — 3 runtime behaviors need manual VS Code testing
- Source label mismatch between parser (`'BBj Compiler'`) and validator Phase 53 hook (`'bbj-cpl'`)

### Global
- 6 pre-existing test failures (unchanged across all phases)
- 14 pre-existing TODO/FIXME comments across 6 files

---

## Summary

Phases 50-52 are complete and verified. The milestone cannot be completed because Phase 53 (BBjCPL Diagnostic Integration) has not been started — 4 requirements (CPL-05 through CPL-08) are unsatisfied. Phase 53 owns the final integration: wiring BBjCPLService.compile() into buildDocuments(), adding the diagnostic source label, extending the hierarchy, and adding the trigger setting.

One latent bug was discovered: the source label mismatch between Phase 52's parser output and Phase 50's classifier hook must be resolved during Phase 53 planning.

---

_Audited: 2026-02-20_
_Auditor: Claude (orchestrator + gsd-integration-checker)_
