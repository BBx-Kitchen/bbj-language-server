---
phase: 05-java-interop
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Language server connects to java-interop service on localhost:5008 at startup"
    - "Typing Java class reference triggers completion popup with Java class names"
    - "After selecting Java class, typing period shows method completions"
    - "Status bar widget shows java-interop connection state"
    - "User sees notification when java-interop is unreachable"
  artifacts: []
  key_links: []
---

<objective>
Human verification of all 5 Phase 5 success criteria. Test with BBjServices running (java-interop available) and not running (java-interop unavailable) to verify both connected and disconnected UX paths.

Purpose: Confirm the full java-interop integration works end-to-end before marking Phase 5 complete.
Output: Verified success criteria, any bug fixes discovered during testing.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-java-interop/05-01-SUMMARY.md
@.planning/phases/05-java-interop/05-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete java-interop integration: settings with port configuration, java-interop connection health check service, separate status bar widget for java-interop state, persistent editor banner when BBjServices is not running, and initializationOptions passing java-interop host/port to the language server.
  </what-built>
  <how-to-verify>
    Launch the plugin sandbox via `./gradlew runIde` from bbj-intellij/.

    **Test 1: BBjServices NOT running (disconnected path)**
    1. Ensure BBjServices is NOT running on your machine
    2. Open a .bbj file in the sandbox IDE
    3. Verify the status bar shows TWO widgets: "BBj: Ready" (green) AND "Java: Disconnected" (gray)
    4. Verify a yellow editor banner appears: "Start BBjServices for Java completions" with "Open Settings" link
    5. Click the "Java: Disconnected" widget -- verify popup with "Reconnect" and "Open Settings" actions
    6. Type a Java class reference (e.g., `DIM obj AS java.lang.String`) -- verify NO Java class completions appear (BBj completions still work)

    **Test 2: BBjServices running (connected path)**
    7. Start BBjServices on your machine (or verify it is running on port 5008)
    8. Wait ~5 seconds for the health check to detect the connection
    9. Verify the status bar widget changes to "Java: Connected" (green icon)
    10. Verify the editor banner disappears
    11. Type `DIM obj AS ` followed by a Java class name -- verify Java class completions appear
    12. After selecting a class, type `obj!` -- verify Java method completions appear with signatures

    **Test 3: Settings**
    13. Open Preferences > Languages & Frameworks > BBj
    14. Verify "Java Interop" section with static "localhost" text and port field showing "5008"
    15. Change port to an invalid value (e.g., "abc") -- verify validation error
    16. Change port to 99999 -- verify validation error (out of range)
    17. Restore port to 5008 and click Apply

    **Test 4: Mid-session disconnect**
    18. With BBjServices running and java-interop connected, stop BBjServices
    19. Wait ~7 seconds (5s check interval + 2s grace period)
    20. Verify widget changes to "Java: Disconnected" and banner reappears

    **Test 5: Widget visibility**
    21. Close all BBj files
    22. Verify both status bar widgets (BBj and Java Interop) are hidden
    23. Open a .bbj file
    24. Verify both widgets reappear
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
All 5 Phase 5 success criteria verified:
1. Language server connects to java-interop service on localhost:5008 at startup
2. Typing Java class reference triggers completion popup with Java class names
3. After selecting Java class, typing period shows method completion with Java method signatures
4. Status bar widget shows java-interop connection state alongside language server state
5. If java-interop service is unreachable, user sees notification explaining BBjServices requirement
</verification>

<success_criteria>
- All 5 success criteria pass
- Both connected and disconnected UX paths work correctly
- Settings UI validates port input correctly
- Grace period prevents banner flashing on transient disconnects
- Widget visibility tracks BBj file focus
</success_criteria>

<output>
After completion, create `.planning/phases/05-java-interop/05-03-SUMMARY.md`
</output>
