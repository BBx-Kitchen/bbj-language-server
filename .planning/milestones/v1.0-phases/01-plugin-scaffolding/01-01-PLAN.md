---
phase: 01-plugin-scaffolding
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-intellij/build.gradle.kts
  - bbj-intellij/settings.gradle.kts
  - bbj-intellij/gradle.properties
  - bbj-intellij/gradlew
  - bbj-intellij/gradlew.bat
  - bbj-intellij/gradle/wrapper/gradle-wrapper.jar
  - bbj-intellij/gradle/wrapper/gradle-wrapper.properties
  - bbj-intellij/src/main/resources/META-INF/plugin.xml
autonomous: true

must_haves:
  truths:
    - "Gradle build system compiles and resolves IntelliJ Platform SDK"
    - "Plugin XML declares valid plugin identity and platform dependency"
    - "./gradlew build completes without errors in bbj-intellij/"
  artifacts:
    - path: "bbj-intellij/build.gradle.kts"
      provides: "Gradle build configuration with IntelliJ Platform Plugin 2.11.0"
      contains: "org.jetbrains.intellij.platform"
    - path: "bbj-intellij/settings.gradle.kts"
      provides: "Gradle settings with platform settings plugin"
      contains: "org.jetbrains.intellij.platform.settings"
    - path: "bbj-intellij/gradle.properties"
      provides: "Gradle JVM and project properties"
      contains: "org.gradle.jvmargs"
    - path: "bbj-intellij/src/main/resources/META-INF/plugin.xml"
      provides: "IntelliJ plugin descriptor"
      contains: "com.basis.bbj.intellij"
    - path: "bbj-intellij/gradlew"
      provides: "Gradle wrapper script (Unix)"
  key_links:
    - from: "bbj-intellij/build.gradle.kts"
      to: "IntelliJ Platform SDK"
      via: "intellijPlatform { intellijIdeaCommunity() }"
      pattern: "intellijIdeaCommunity"
    - from: "bbj-intellij/settings.gradle.kts"
      to: "bbj-intellij/build.gradle.kts"
      via: "rootProject.name matching"
      pattern: "rootProject.name"
---

<objective>
Create the Gradle project skeleton for the IntelliJ plugin in bbj-intellij/ with a working build system that resolves the IntelliJ Platform SDK.

Purpose: Establishes the foundational build infrastructure that all subsequent plugin code will be added to. Without a working Gradle build, no Java source files can be compiled or tested against the IntelliJ Platform API.

Output: A buildable (but empty) IntelliJ plugin project with Gradle wrapper, build scripts, and minimal plugin.xml.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-plugin-scaffolding/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Gradle wrapper and build scripts</name>
  <files>
    bbj-intellij/build.gradle.kts
    bbj-intellij/settings.gradle.kts
    bbj-intellij/gradle.properties
    bbj-intellij/gradlew
    bbj-intellij/gradlew.bat
    bbj-intellij/gradle/wrapper/gradle-wrapper.jar
    bbj-intellij/gradle/wrapper/gradle-wrapper.properties
  </files>
  <action>
    Create the bbj-intellij/ directory at the repo root (alongside bbj-vscode/).

    Generate Gradle wrapper files by running `gradle wrapper --gradle-version 8.12` inside bbj-intellij/ (or download wrapper files directly if gradle CLI not available). If system gradle is not installed, use the java-interop/gradlew as a bootstrap: copy gradle wrapper files from java-interop/ to bbj-intellij/, then update gradle-wrapper.properties to use Gradle 8.12.

    Create `settings.gradle.kts`:
    ```kotlin
    plugins {
        id("org.jetbrains.intellij.platform.settings") version "2.11.0"
    }

    rootProject.name = "bbj-intellij"
    ```

    Create `gradle.properties`:
    ```properties
    org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8
    ```

    Create `build.gradle.kts`:
    ```kotlin
    plugins {
        id("java")
        id("org.jetbrains.intellij.platform") version "2.11.0"
    }

    group = "com.basis.bbj"
    version = "0.1.0-alpha"

    java {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }

    repositories {
        mavenCentral()
        intellijPlatform {
            defaultRepositories()
        }
    }

    dependencies {
        intellijPlatform {
            intellijIdeaCommunity("2024.2")
            pluginVerifier()
            zipSigner()
            instrumentationTools()
        }
    }

    tasks {
        patchPluginXml {
            sinceBuild.set("242")
            untilBuild.set("243.*")
        }
    }
    ```

    IMPORTANT: Use IntelliJ Platform Gradle Plugin version 2.11.0 (NOT the legacy `org.jetbrains.intellij` plugin). The new plugin uses `org.jetbrains.intellij.platform` as the plugin ID and has a different DSL for dependencies.
  </action>
  <verify>
    Run `cd bbj-intellij && ./gradlew tasks --no-daemon` and confirm it resolves dependencies and lists IntelliJ Platform tasks (buildPlugin, runIde, patchPluginXml, etc.) without errors.
  </verify>
  <done>
    Gradle wrapper exists, build.gradle.kts and settings.gradle.kts are valid, `./gradlew tasks` completes successfully showing IntelliJ Platform tasks.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create minimal plugin.xml descriptor</name>
  <files>
    bbj-intellij/src/main/resources/META-INF/plugin.xml
  </files>
  <action>
    Create the directory structure `src/main/resources/META-INF/` inside bbj-intellij/.

    Create `plugin.xml` with the minimal descriptor that declares the plugin identity and platform dependency. Do NOT add any extensions yet (those come in Plan 02 when the Java classes exist).

    ```xml
    <idea-plugin>
        <id>com.basis.bbj.intellij</id>
        <name>BBj Language Support</name>
        <version>0.1.0</version>
        <vendor email="support@basis.cloud" url="https://basis.cloud">BASIS International</vendor>

        <description><![CDATA[
            BBj language support for IntelliJ IDEA. Provides file type recognition,
            syntax highlighting, and language server integration for BBj development.
        ]]></description>

        <idea-version since-build="242"/>

        <depends>com.intellij.modules.platform</depends>
    </idea-plugin>
    ```

    IMPORTANT:
    - The `<depends>com.intellij.modules.platform</depends>` is required for Community Edition compatibility.
    - Do NOT add `<extensions>` block yet. The fileType extension requires the BbjFileType class which is created in Plan 02.
    - The `<idea-version since-build="242"/>` matches IntelliJ 2024.2.x.
  </action>
  <verify>
    Run `cd bbj-intellij && ./gradlew build --no-daemon` and confirm the build succeeds. The plugin should build even without any Java source files (it will just be an empty plugin).
  </verify>
  <done>
    plugin.xml exists at src/main/resources/META-INF/plugin.xml, declares plugin ID "com.basis.bbj.intellij", and `./gradlew build` passes.
  </done>
</task>

</tasks>

<verification>
1. `bbj-intellij/` directory exists at repo root alongside `bbj-vscode/`
2. `cd bbj-intellij && ./gradlew build --no-daemon` completes with BUILD SUCCESSFUL
3. `bbj-intellij/src/main/resources/META-INF/plugin.xml` contains valid plugin descriptor
4. Gradle wrapper files are present and executable
</verification>

<success_criteria>
- Gradle build completes successfully with IntelliJ Platform SDK resolved
- plugin.xml is valid and declares correct plugin identity
- Project structure follows IntelliJ plugin conventions
- Ready for Java source files to be added in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/01-plugin-scaffolding/01-01-SUMMARY.md`
</output>
