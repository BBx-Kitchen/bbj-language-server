---
phase: 46-vs-code-user-guide-audit
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - documentation/docs/vscode/configuration.md
  - documentation/docs/vscode/commands.md
autonomous: true

must_haves:
  truths:
    - "Configuration page does NOT mention bbj.web.username or bbj.web.password"
    - "Configuration page documents token-based EM authentication via bbj.loginEM command"
    - "Configuration page documents bbj.em.url, bbj.configPath, bbj.typeResolution.warnings, bbj.interop.host, bbj.interop.port settings"
    - "Commands page does NOT mention Decompile command"
    - "Commands page includes Login to Enterprise Manager, Refresh Java Classes, and Configure Compile Options commands"
  artifacts:
    - path: "documentation/docs/vscode/configuration.md"
      provides: "Audited configuration page with token auth and all v3.x settings"
      contains: "bbj.em.url"
    - path: "documentation/docs/vscode/commands.md"
      provides: "Audited commands page without phantom commands"
      contains: "refreshJavaClasses"
  key_links:
    - from: "documentation/docs/vscode/configuration.md"
      to: "bbj-vscode/package.json"
      via: "documented settings match contributes.configuration.properties"
      pattern: "bbj\\.interop\\.host|bbj\\.configPath|bbj\\.typeResolution"
    - from: "documentation/docs/vscode/commands.md"
      to: "bbj-vscode/package.json"
      via: "documented commands match contributes.commands"
      pattern: "refreshJavaClasses|loginEM|configureCompileOptions"
---

<objective>
Audit the VS Code Configuration and Commands pages to remove obsolete settings/commands and add all missing v3.x additions.

Purpose: Ensure configuration and commands documentation reflects the actual extension settings and commands (VSCA-02, VSCA-03, and remaining VSCA-01 additions).
Output: Two updated documentation pages with accurate content.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@bbj-vscode/package.json
@documentation/docs/vscode/configuration.md
@documentation/docs/vscode/commands.md
@documentation/docs/intellij/configuration.md
@documentation/docs/intellij/commands.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and update Configuration page</name>
  <files>documentation/docs/vscode/configuration.md</files>
  <action>
Read the current configuration.md and bbj-vscode/package.json `contributes.configuration.properties`. Make these edits:

**REMOVE (phantom settings):**
1. Delete the `bbj.web.username` section entirely (lines ~69-76). This setting does NOT exist in package.json.
2. Delete the `bbj.web.password` section entirely (lines ~79-87). This setting does NOT exist in package.json.
3. In the "Complete Settings Example" JSON block, remove `bbj.web.username` and `bbj.web.password` entries.
4. In the "Enterprise Manager" section at the bottom, remove the line "Configure the connection using `bbj.web.username` and `bbj.web.password`." Replace with token auth description.

**ADD (missing v3.x settings):**

5. Add `bbj.em.url` setting section under Web/BUI Settings (or rename section to "Enterprise Manager Settings"):

#### `bbj.em.url`

Enterprise Manager URL for BUI/DWC run commands and authentication.

```json
{
  "bbj.em.url": "http://localhost:8888"
}
```

**Default**: `null` (defaults to `http://localhost:8888` when not set)

6. Add `bbj.configPath` setting in a new "Advanced Settings" section or after Core Settings:

#### `bbj.configPath`

Path to a custom `config.bbx` file. When not set, defaults to `{bbj.home}/cfg/config.bbx`.

```json
{
  "bbj.configPath": "/path/to/custom/config.bbx"
}
```

**Default**: `null` (uses `{bbj.home}/cfg/config.bbx`)

Set this when your `config.bbx` is in a non-standard location. Used for PREFIX directory resolution.

7. Add `bbj.typeResolution.warnings` setting:

#### `bbj.typeResolution.warnings`

Enable or disable type resolution warnings (CAST, USE, inheritance). Disable for heavily dynamic codebases where these warnings are noisy.

```json
{
  "bbj.typeResolution.warnings": true
}
```

**Default**: `true`

8. Update the "Java Interop Service" section. Change from hardcoded port 5008 to document the configurable settings:

#### `bbj.interop.host`

Hostname for the Java interop service.

```json
{
  "bbj.interop.host": "localhost"
}
```

**Default**: `"localhost"`

Change this to connect to a remote Java interop instance.

#### `bbj.interop.port`

Port number for the Java interop service.

```json
{
  "bbj.interop.port": 5008
}
```

**Default**: `5008`

9. Add "Enterprise Manager Authentication" section replacing the old username/password flow. Document token-based auth:

### Enterprise Manager Authentication

BUI and DWC run commands require authentication with Enterprise Manager.

**Authentication Flow:**
1. Run `BBj: Login to Enterprise Manager` from the Command Palette
2. Enter your EM username and password in the dialog
3. The extension stores the JWT token securely in VS Code's SecretStorage
4. Token is used automatically for subsequent BUI/DWC runs
5. Re-authenticate if the token expires

The stored token persists across VS Code restarts. No plaintext passwords are stored in settings.

10. Update the "Complete Settings Example" to include all new settings and remove removed ones. The example should show:
```json
{
  "bbj.home": "/opt/bbj",
  "bbj.classpath": "bbj_default",
  "bbj.debug": false,
  "bbj.em.url": "http://localhost:8888",
  "bbj.configPath": null,
  "bbj.typeResolution.warnings": true,
  "bbj.interop.host": "localhost",
  "bbj.interop.port": 5008,
  "bbj.web.AutoSaveUponRun": true,
  "bbj.formatter.indentWidth": 4,
  "bbj.formatter.removeLineContinuation": false,
  "bbj.formatter.keywordsToUppercase": true,
  "bbj.formatter.splitSingleLineIF": false
}
```

Note: Do NOT document the `bbj.compiler.*` settings individually — they are managed through the "Configure Compile Options" command UI. Just mention their existence in a note.

11. Remove the manual `cd java-interop && ./gradlew run` instructions from the Java Interop section. The service is managed by BBjServices, not manually started.
  </action>
  <verify>
Grep the updated configuration.md:
- "bbj.web.username" and "bbj.web.password" must NOT appear
- "bbj.em.url" must appear at least once
- "bbj.configPath" must appear at least once
- "bbj.typeResolution.warnings" must appear at least once
- "bbj.interop.host" and "bbj.interop.port" must each appear at least once
- "SecretStorage" or "token" must appear (token auth documented)
- "gradlew" must NOT appear
  </verify>
  <done>Configuration page documents token-based EM auth, includes all v3.x settings, and contains no phantom settings or manual service instructions.</done>
</task>

<task type="auto">
  <name>Task 2: Audit and update Commands page</name>
  <files>documentation/docs/vscode/commands.md</files>
  <action>
Read the current commands.md and bbj-vscode/package.json `contributes.commands`. Make these edits:

**REMOVE (phantom commands):**
1. Delete the entire "### Decompile (`Alt+X`)" section (lines ~62-69). The `bbj.decompile` command does NOT exist in package.json.
2. Remove Decompile from the "Keyboard Shortcuts Summary" table.
3. Remove Decompile from the "Editor Context Menu" list.

**ADD (missing commands):**

4. Add "### Login to Enterprise Manager" section under Configuration Commands:

### Login to Enterprise Manager

Authenticates with BBj Enterprise Manager and stores the JWT token for BUI/DWC run commands.

**Command ID:** `bbj.loginEM`

**Usage:**
1. Open the Command Palette (`Ctrl+Shift+P` / `Cmd+Shift+P`)
2. Type "BBj: Login to Enterprise Manager"
3. Enter your Enterprise Manager username and password
4. Token is stored securely in VS Code's SecretStorage

**Required for:** Running BUI and DWC programs. Token persists across VS Code restarts.

5. Add "### Refresh Java Classes" section:

### Refresh Java Classes

Reloads the Java classpath and clears cached class information.

**Command ID:** `bbj.refreshJavaClasses`

**Usage:** Run from the Command Palette when Java classes are not appearing in code completion, or after classpath changes in Enterprise Manager.

6. Add "### Configure Compile Options" section:

### Configure Compile Options

Opens a settings dialog to configure BBj compiler options (type checking, line numbering, output settings, content protection, and diagnostics).

**Command ID:** `bbj.configureCompileOptions`

**Usage:** Run from the Command Palette to configure compiler flags before compiling.

7. Update the "Editor Context Menu" and "Explorer Context Menu" sections to remove Decompile. The actual menus registered in package.json show: Run (GUI), Run (BUI), Run (DWC), Compile, Denumber — no Decompile.

8. Update the "Requirements" section at the bottom to add:
- For BUI/DWC commands: Enterprise Manager accessible and authenticated (use `BBj: Login to Enterprise Manager`)

9. Update the "Run Commands Fail" and add a "BUI/DWC Commands Fail" troubleshooting subsection:
If BUI or DWC run commands fail:
1. Verify Enterprise Manager is accessible at the configured EM URL
2. Authenticate using `BBj: Login to Enterprise Manager` from the Command Palette
3. Check if the token has expired (re-authenticate if needed)
  </action>
  <verify>
Grep the updated commands.md:
- "Decompile" or "decompile" or "bbj.decompile" must NOT appear
- "loginEM" must appear at least once
- "refreshJavaClasses" must appear at least once
- "configureCompileOptions" must appear at least once
- "Alt+X" must NOT appear (that was the Decompile shortcut)
  </verify>
  <done>Commands page lists only existing commands, includes Login to EM, Refresh Java Classes, and Configure Compile Options, and has no Decompile references.</done>
</task>

</tasks>

<verification>
1. `grep -i "decompile" documentation/docs/vscode/commands.md` returns nothing
2. `grep "username\|password" documentation/docs/vscode/configuration.md` returns only in the context of EM login dialog prompt, NOT as settings
3. `grep "bbj.em.url" documentation/docs/vscode/configuration.md` returns at least one match
4. `grep "bbj.configPath" documentation/docs/vscode/configuration.md` returns at least one match
5. `grep "bbj.typeResolution.warnings" documentation/docs/vscode/configuration.md` returns at least one match
6. `grep "loginEM" documentation/docs/vscode/commands.md` returns at least one match
7. `grep "refreshJavaClasses" documentation/docs/vscode/commands.md` returns at least one match
8. `grep "configureCompileOptions" documentation/docs/vscode/commands.md` returns at least one match
</verification>

<success_criteria>
- Configuration page has no plaintext password settings, documents token auth, includes all v3.x settings
- Commands page has no Decompile, includes all three missing commands
- Requirements VSCA-02, VSCA-03, and VSCA-01 (v3.x feature additions) fully addressed
</success_criteria>

<output>
After completion, create `.planning/phases/46-vs-code-user-guide-audit/46-02-SUMMARY.md`
</output>
