# Milestone v3.2: Bug Fix Release

**Status:** SHIPPED 2026-02-08
**Phases:** 32-34
**Total Plans:** 10

## Overview

Fix regressions and parser bugs that produce false errors on valid BBj code, restoring broken functionality and eliminating noise in the diagnostics output.

## Phases

### Phase 32: Regression Fixes
**Goal**: BBjAPI() resolves correctly and USE statement navigation works again -- restoring functionality that broke in v3.1
**Depends on**: Nothing (first phase, highest priority)
**Requirements**: REG-01, REG-02
**Success Criteria** (what must be TRUE):
  1. Typing `api! = BBjAPI()` produces no linker error and `api!` has type `BBjAPI`
  2. Code completion works on variables assigned from `BBjAPI()` (e.g., `api!.` shows methods)
  3. Ctrl-click on a class name in a `USE` statement navigates to the class definition file resolved via PREFIX path
  4. No regressions in existing linker or navigation tests
**Plans:** 3 plans
Plans:
- [x] 32-01-PLAN.md -- BBjAPI() built-in synthetic class and linker fix
- [x] 32-02-PLAN.md -- USE statement Ctrl-click navigation (DefinitionProvider)
- [x] 32-03-PLAN.md -- Manual verification + onDidChangeConfiguration regression fix

### Phase 33: Parser and Lexer Fixes
**Goal**: Valid BBj syntax patterns that currently produce false errors parse cleanly without diagnostics
**Depends on**: Phase 32 (regressions first)
**Requirements**: PARSE-01, PARSE-02, PARSE-03, PARSE-04
**Success Criteria** (what must be TRUE):
  1. `method public void doSomething()` parses without flagging `void` as an unresolvable class
  2. `mode$` and other `$`-suffixed string variables inside DEF FN within class methods produce no lexer errors
  3. `select` statements with `from`/`where` clauses produce no false line-break validation errors
  4. `cast(BBjString[], someVar!)` with array type notation `[]` parses correctly
  5. Existing parser tests continue to pass (no regressions)
**Plans:** 3 plans
Plans:
- [x] 33-01-PLAN.md -- Fix void return type (PARSE-01) and cast array notation (PARSE-04, deferred)
- [x] 33-02-PLAN.md -- Fix DEF FN suffixed variables (PARSE-02) and add SELECT verb (PARSE-03)
- [x] 33-03-PLAN.md -- Gap closure: CastExpression grammar rule for array type notation (PARSE-04)

### Phase 34: Diagnostic Polish
**Goal**: Settings display the correct product name and USE statements with bad file paths get actionable error messages
**Depends on**: Phase 33 (fixes before polish)
**Requirements**: POL-01, POL-02
**Success Criteria** (what must be TRUE):
  1. VS Code settings panel shows "BBj" (capital B, capital B, lowercase j) in all setting labels, not "Bbj"
  2. A USE statement referencing a non-existent file path shows an error diagnostic on the file name portion of the USE statement
  3. USE statements with valid file paths show no new diagnostics
**Plans:** 4 plans
Plans:
- [x] 34-01-PLAN.md -- Fix settings capitalization (POL-01) and USE file path validation (POL-02)
- [x] 34-02-PLAN.md -- Gap closure: reconcile USE file-path diagnostics after PREFIX docs indexed
- [x] 34-03-PLAN.md -- Gap closure: fix URI comparison, add logging, include searched paths in error
- [x] 34-04-PLAN.md -- Gap closure: binary file detection, runtime logging, post-index verification

## Progress

**Execution Order:**
Phases execute in numeric order: 32 -> 33 -> 34

| Phase | Milestone | Plans Complete | Status | Completed |
|-------|-----------|----------------|--------|-----------|
| 32. Regression Fixes | v3.2 | 3/3 | Complete | 2026-02-07 |
| 33. Parser and Lexer Fixes | v3.2 | 3/3 | Complete | 2026-02-08 |
| 34. Diagnostic Polish | v3.2 | 4/4 | Complete | 2026-02-08 |

---

## Milestone Summary

**Key Decisions:**

- Built-in synthetic BBjAPI via loadAdditionalDocuments (independent of Java interop)
- Override collectLocationLinks for DefinitionProvider (preserves Langium pipeline)
- Settings change detection guard (skip reload when BBj settings unchanged)
- voidReturn boolean property (avoids false "unresolvable class" errors)
- LONGER_ALT array [id, idWithSuffix] for keywords (prevents mode$ vs MODE conflict)
- CastExpression as dedicated PrimaryExpression alternative (avoids ArrayElement ambiguity)
- normalize(fsPath) equality for cross-document URI comparison (3 locations)
- Binary <<bbj>> header detection before parsing PREFIX files
- USE_FILE_NOT_RESOLVED_PREFIX sentinel pattern for diagnostic filtering

**Issues Resolved:**

- BBjAPI() linker regression (synthetic document approach)
- USE statement navigation regression (custom DefinitionProvider)
- onDidChangeConfiguration race condition (settings change detection)
- void return type false errors (voidReturn property)
- DEF FN suffixed variable false errors (LONGER_ALT fix)
- SELECT verb false errors (full grammar support)
- Cast array notation parse failures (CastExpression grammar rule)
- USE file path validation (PREFIX reconciliation, binary detection)

**Issues Deferred:**

- CPU stability mitigations (#232) — requires deep Langium changes
- VS Code settings group header "Bbj:" — platform limitation, accepted

**Technical Debt Incurred:**

- Dead code from old CAST MethodCall handling (CastExpression replaces it)
- Phase 32 has no formal VERIFICATION.md (inferred pass from execution evidence)

---

_For current project status, see .planning/ROADMAP.md_
