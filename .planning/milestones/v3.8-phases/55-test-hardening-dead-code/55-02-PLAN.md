---
phase: 55-test-hardening-dead-code
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-vscode/src/language/bbj-type-inferer.ts
  - bbj-vscode/src/language/bbj-validator.ts
autonomous: true
requirements:
  - DEAD-01
  - DEAD-02

must_haves:
  truths:
    - "The MethodCall CAST branch is deleted from bbj-type-inferer.ts with no test regressions"
    - "checkCastTypeResolvable for MethodCall is deleted from bbj-validator.ts (both method body and registration call)"
    - "Newly-unused imports are cleaned up, but BbjClass import in bbj-validator.ts is retained"
    - "npm test exits 0 after all deletions"
  artifacts:
    - path: "bbj-vscode/src/language/bbj-type-inferer.ts"
      provides: "Type inferer without dead MethodCall CAST branch"
    - path: "bbj-vscode/src/language/bbj-validator.ts"
      provides: "Validator without dead checkCastTypeResolvable method"
  key_links:
    - from: "bbj-vscode/src/language/bbj-validator.ts"
      to: "bbj-vscode/src/language/bbj-type-inferer.ts"
      via: "TypeInferer import for getType()"
      pattern: "this.typeInferer"
---

<objective>
Remove the confirmed dead MethodCall CAST branches from `bbj-type-inferer.ts` and `bbj-validator.ts`. Since Phase 33 introduced `CastExpression` as a grammar-level construct, `cast()` calls are no longer parsed as `MethodCall` — making these branches unreachable dead code.

Purpose: Reduce codebase size and remove misleading code paths that can never execute. The `CastExpression` grammar rule and `checkCastExpressionTypeResolvable` validator already handle all CAST operations correctly.

Output: Two source files with dead code removed, unused imports cleaned up, all tests still passing.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/55-test-hardening-dead-code/55-CONTEXT.md
@bbj-vscode/src/language/bbj-type-inferer.ts
@bbj-vscode/src/language/bbj-validator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify dead code status and remove MethodCall CAST branches</name>
  <files>bbj-vscode/src/language/bbj-type-inferer.ts, bbj-vscode/src/language/bbj-validator.ts</files>
  <action>
**Step 1: Verify before removing (belt and suspenders)**

Grep the entire codebase for any unexpected references to the dead code:
- `grep -r "checkCastTypeResolvable" bbj-vscode/src/` — should only appear in bbj-validator.ts (line 48 registration + line 86 method definition)
- `grep -r "isMethodCall" bbj-vscode/src/` — should only appear in bbj-type-inferer.ts line 88
- Confirm: If either grep reveals unexpected callers, DO NOT remove that code. Document the finding and skip.

**Step 2: Remove dead code from `bbj-type-inferer.ts` (DEAD-01)**

Delete the `isMethodCall` branch (lines 88-108) from the `getType()` method. This is the `} else if(isMethodCall(expression)) {` block that checks for CAST() calls parsed as MethodCall. The code flow should go directly from the `isStringLiteral` branch to `isMemberCall`.

Then clean up imports on line 4: remove `isMethodCall` and `isLibFunction` from the import statement. Both are ONLY used in the dead branch. Keep all other imports — they are used elsewhere in the file.

**Step 3: Remove dead code from `bbj-validator.ts` (DEAD-02)**

1. Delete the registration line (line 48): `MethodCall: validator.checkCastTypeResolvable,`
2. Delete the entire `checkCastTypeResolvable` method body (lines 86-122)
3. Clean up imports on line 11: remove `MethodCall` and `isLibFunction` — both are ONLY used in the dead code
4. **CRITICAL: Do NOT remove `BbjClass` from the import on line 11** — it was added by Phase 54 for `checkUsedClassExists` and is still actively used

Import removal guide for bbj-validator.ts line 11:
- `MethodCall` — REMOVE (only used in dead registration + dead method signature)
- `isLibFunction` — REMOVE (only used in dead checkCastTypeResolvable method body)
- `BbjClass` — KEEP (used by checkUsedClassExists added in Phase 54)
- `isArrayElement` — Check if used elsewhere in file. If only in dead code, REMOVE. If used in `checkCastExpressionTypeResolvable`, KEEP.

**Step 4: Verify**

Run `npm test` from `bbj-vscode/`. All tests must pass (exit 0). Run `npx tsc --noEmit` to verify no TypeScript compilation errors from dangling imports or references.
  </action>
  <verify>
1. `npm test` exits 0 with all tests passing
2. `npx tsc --noEmit` exits 0 (no type errors)
3. `grep "isMethodCall" bbj-vscode/src/language/bbj-type-inferer.ts` returns nothing (import and usage removed)
4. `grep "checkCastTypeResolvable" bbj-vscode/src/language/bbj-validator.ts` returns nothing (registration and method removed)
5. `grep "BbjClass" bbj-vscode/src/language/bbj-validator.ts` still returns a match (import retained)
  </verify>
  <done>
The MethodCall CAST branch is fully removed from `bbj-type-inferer.ts`. The `checkCastTypeResolvable` method and its registration are fully removed from `bbj-validator.ts`. All newly-unused imports are cleaned up. `BbjClass` import is retained. `npm test` and `tsc --noEmit` both exit 0.
  </done>
</task>

</tasks>

<verification>
1. `grep -c "isMethodCall" bbj-vscode/src/language/bbj-type-inferer.ts` returns 0
2. `grep -c "checkCastTypeResolvable" bbj-vscode/src/language/bbj-validator.ts` returns 0
3. `grep -c "BbjClass" bbj-vscode/src/language/bbj-validator.ts` returns >= 1 (import retained)
4. `npm test` exits 0 with >= 501 tests passing
5. `npx tsc --noEmit` exits 0
</verification>

<success_criteria>
- MethodCall CAST branch deleted from `bbj-type-inferer.ts` (DEAD-01)
- `checkCastTypeResolvable` method and registration deleted from `bbj-validator.ts` (DEAD-02)
- Unused imports cleaned up; BbjClass import preserved
- Full test suite passes with no regressions
- TypeScript compilation succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/55-test-hardening-dead-code/55-02-SUMMARY.md`
</output>
