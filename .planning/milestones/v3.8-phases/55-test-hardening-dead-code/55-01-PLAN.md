---
phase: 55-test-hardening-dead-code
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-vscode/test/parser.test.ts
autonomous: true
requirements:
  - HARD-01

must_haves:
  truths:
    - "All 9 previously commented-out expectNoValidationErrors() calls in parser.test.ts are uncommented and the tests pass"
    - "Any assertion that cannot be enabled has a clear inline comment explaining why and what would need to change"
    - "npm test exits 0 with no new test failures"
  artifacts:
    - path: "bbj-vscode/test/parser.test.ts"
      provides: "Re-enabled validation assertions for parser tests"
      contains: "expectNoValidationErrors(result)"
  key_links:
    - from: "bbj-vscode/test/parser.test.ts"
      to: "bbj-vscode/src/language/bbj-validator.ts"
      via: "validation diagnostics on parsed documents"
      pattern: "expectNoValidationErrors"
---

<objective>
Re-enable the 9 commented-out `expectNoValidationErrors()` assertions in `parser.test.ts` so the parser test suite validates that parsed BBj programs produce no validation errors.

Purpose: These assertions were disabled (prefixed with `//TODO`) at some point when the validator was producing diagnostics on valid parser test inputs. Re-enabling them ensures the test suite catches validation regressions on syntactically valid BBj programs.

Output: `parser.test.ts` with all 9 assertions investigated and either re-enabled or documented with clear rationale for why they remain disabled.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/55-test-hardening-dead-code/55-CONTEXT.md
@bbj-vscode/test/parser.test.ts
@bbj-vscode/src/language/bbj-validator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Investigate and re-enable 9 disabled validation assertions</name>
  <files>bbj-vscode/test/parser.test.ts</files>
  <action>
There are 9 commented-out `//TODO expectNoValidationErrors(result);` calls in `parser.test.ts` at lines 455, 482, 500, 545, 593, 814, 859, 933, 987. For EACH assertion:

1. **Uncomment the assertion** (remove `//TODO ` prefix)
2. **Run the individual test** to see if it passes: `npx vitest run test/parser.test.ts -t "TEST_NAME"`
3. **If it passes:** Move to the next assertion. Done.
4. **If it fails with validation errors:** Investigate the diagnostics:
   - Capture the actual diagnostic messages
   - Determine if they indicate a REAL BUG in the validator or LEGITIMATE diagnostics on the test input
   - **If legitimate diagnostic:** Adjust the test input to avoid triggering the diagnostic (e.g., add missing declarations, fix scoping) OR filter the specific expected diagnostics. Choose whichever best preserves the original test intent (testing parser grammar, not validation).
   - **If real bug AND fix is straightforward (< 30 min):** Fix the bug in the validator and document the fix
   - **If real bug AND fix is complex:** Re-comment the assertion with an explanatory comment replacing `//TODO` that says WHY it fails and WHAT would need to change. Example: `// DISABLED: emits spurious 'unresolved type' warning on CAST — needs grammar-level fix for array type notation`
5. After all 9 assertions are processed, run the full test suite: `npm test`

The 9 assertions and their test contexts:
- Line 455: 'Check DIM template' test — DIM statement with templates
- Line 482: 'Check throw statement syntax' — throw inside class method
- Line 500: 'Check throw statement syntax with ERR=linefref' — throw with ERR= option
- Line 545: 'Check substring other cases' — `new String()(1)` substring expression
- Line 593: 'Check CALL and RUN' — CALL and RUN statements with labels
- Line 814: 'Release usage' — BBjAPI().getGlobalNamespace().getValue() method chain
- Line 859: 'Array type ref' — String[] and byte[] type references in class fields/methods
- Line 933: 'Check SWITCH...CASE...SWEND verb' — switch statement
- Line 987: 'Check REDIM verb' — REDIM with template and ERR= label

Per user decision: best effort — enable as many as possible, no hard minimum. Any that remain disabled must have clear inline comments explaining why.
  </action>
  <verify>
Run `npm test` from `bbj-vscode/`. All tests pass (exit 0). Count of `//TODO expectNoValidationErrors` should be 0 (all either re-enabled or replaced with explanatory comment). Count of uncommented `expectNoValidationErrors` calls should have increased.
  </verify>
  <done>
All 9 previously commented-out assertions are either (a) uncommented and passing, or (b) have a clear inline comment explaining the root cause and what would need to change. `npm test` exits 0.
  </done>
</task>

</tasks>

<verification>
1. `grep -c "//TODO expectNoValidationErrors" bbj-vscode/test/parser.test.ts` returns 0 (no unexplained disabled assertions)
2. `npm test` exits 0 with no new failures
3. Test count is >= 501 passed (no decrease from current baseline)
</verification>

<success_criteria>
- All 9 `//TODO expectNoValidationErrors` assertions in `parser.test.ts` are resolved (uncommented or documented)
- `npm test` exits 0
- No new test skips beyond the existing 4
</success_criteria>

<output>
After completion, create `.planning/phases/55-test-hardening-dead-code/55-01-SUMMARY.md`
</output>
