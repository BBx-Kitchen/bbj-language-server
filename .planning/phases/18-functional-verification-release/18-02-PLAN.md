---
phase: 18-functional-verification-release
plan: 02
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - .planning/phases/18-functional-verification-release/18-VERIFICATION-REPORT.md
autonomous: false

must_haves:
  truths:
    - "VS Code .vsix package builds successfully from current source"
    - "IntelliJ .zip artifact builds successfully with updated main.cjs"
    - "A pass/fail verification report exists for all 9 language features"
    - "User has confirmed IntelliJ plugin loads and basic features work"
  artifacts:
    - path: ".planning/phases/18-functional-verification-release/18-VERIFICATION-REPORT.md"
      provides: "Pass/fail report for all 9 features + release artifact status"
      contains: "FUNC-01"
  key_links:
    - from: "bbj-vscode/out/language/main.cjs"
      to: "bbj-intellij/build/distributions/"
      via: "Gradle copyLanguageServer task"
      pattern: "copyLanguageServer"
---

<objective>
Build release artifacts (VS Code .vsix and IntelliJ .zip) as packaging verification, then produce a structured pass/fail verification report for all 9 language features and the IntelliJ build. User manually verifies IntelliJ runtime at checkpoint.

Purpose: This is the final gate before the user publishes. Building artifacts proves the full toolchain works. The verification report maps every FUNC requirement to evidence (automated test results + build output). No version bumps or publishing -- user handles that separately per CONTEXT.md decisions.

Output: Built .vsix and .zip artifacts (not committed), verification report documenting pass/fail for every requirement.

**Out of scope (user-handled per CONTEXT.md decisions):**
- RELS-01: VS Code extension publishing (user runs `vsce publish`)
- RELS-02: IntelliJ plugin publishing (user uploads to JetBrains marketplace)
- RELS-03: Version number bumps (user handles all version changes in package.json, build.gradle.kts, etc.)
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-functional-verification-release/18-CONTEXT.md
@.planning/phases/18-functional-verification-release/18-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build release artifacts and produce verification report</name>
  <files>.planning/phases/18-functional-verification-release/18-VERIFICATION-REPORT.md</files>
  <action>
Execute the full build and artifact creation pipeline, then compile a verification report.

**Step 1: Clean build**
```bash
cd /Users/beff/_workspace/bbj-language-server/bbj-vscode
npm run build
```
Verify exit code 0 (tsc + esbuild both succeed). Record output.

**Step 2: Run full test suite**
```bash
cd /Users/beff/_workspace/bbj-language-server/bbj-vscode
npm test
```
Record test results. Note total tests passed vs failed. The functional tests from Plan 01 should be included in this run.

**Step 3: Build VS Code .vsix**
```bash
cd /Users/beff/_workspace/bbj-language-server/bbj-vscode
npx @vscode/vsce package --no-git-tag-version --no-update-package-json
```
Note: Use `--no-git-tag-version` and `--no-update-package-json` to prevent version modifications (user handles versioning). If vsce prompts about LICENSE, ensure LICENSE file exists in bbj-vscode/ (the vscode:prepublish script copies it). If the command fails due to missing LICENSE, run `cp ../LICENSE ./LICENSE` first.

Verify .vsix file is created. Record filename and size. Check that `out/language/main.cjs` is included:
```bash
unzip -l bbj-lang-*.vsix | grep main.cjs
```

**Step 4: Build IntelliJ plugin**
```bash
cd /Users/beff/_workspace/bbj-language-server/bbj-intellij
./gradlew clean buildPlugin
```
Verify BUILD SUCCESSFUL. Check artifact exists in `build/distributions/`. Record filename and size. Verify main.cjs is bundled:
```bash
unzip -l build/distributions/bbj-intellij-*.zip | grep main.cjs
```

**Step 5: Write verification report**

Create `.planning/phases/18-functional-verification-release/18-VERIFICATION-REPORT.md` with this structure:

```markdown
# Phase 18: Functional Verification Report

**Date:** [date]
**Branch:** langium_upgrade
**Baseline:** Phase 17 complete (56/58 tests passing)

## Feature Verification

| Req | Feature | Method | Result | Evidence |
|-----|---------|--------|--------|----------|
| FUNC-01 | Syntax highlighting | TextMate grammar (no LS dependency) | PASS/FAIL | bbj.tmLanguage.json unchanged |
| FUNC-02 | Diagnostics | Automated test | PASS/FAIL | lsp-features.test.ts |
| FUNC-03 | BBj completion | Automated test | PASS/FAIL | lsp-features.test.ts |
| FUNC-04 | Java completion | Automated test | PASS/FAIL | lsp-features.test.ts |
| FUNC-05 | Hover info | [see pre-defined method below] | PASS/FAIL | [see evidence below] |
| FUNC-06 | Signature help | [see pre-defined method below] | PASS/FAIL | [see evidence below] |
| FUNC-07 | Go-to-definition | [see pre-defined method below] | PASS/FAIL | [see evidence below] |
| FUNC-08 | Document symbols | Automated test | PASS/FAIL | lsp-features.test.ts |
| FUNC-09 | Semantic tokens | Automated test | PASS/FAIL | lsp-features.test.ts |
| FUNC-10 | IntelliJ plugin | Build verification + manual | PENDING | User to verify at checkpoint |

## Pre-defined Verification Methods for FUNC-05, FUNC-06, FUNC-07

**FUNC-05 (Hover):** Determine result as follows:
- If lsp-features.test.ts contains a direct HoverProvider test that passes: **PASS - Direct automated test** (cite test name)
- If no direct test: **PASS - Verified by infrastructure** ONLY IF all three conditions are met:
  1. `bbj-hover.ts` exists and exports a hover provider class
  2. Hover provider is registered in `bbj-module.ts` (grep for HoverProvider)
  3. `linking.test.ts` passes (11 non-interop tests prove reference resolution, which hover depends on)
- If any of those conditions fail: **FAIL** with specific reason

**FUNC-06 (Signature help):** Determine result as follows:
- If lsp-features.test.ts contains a direct SignatureHelpProvider test that passes: **PASS - Direct automated test** (cite test name)
- If no direct test: **PASS - Verified by infrastructure** ONLY IF all three conditions are met:
  1. `bbj-signature-help-provider.ts` exists and exports a signature help provider class
  2. Signature help provider is registered in `bbj-module.ts` (grep for SignatureHelpProvider)
  3. Parser tests pass (function call parsing, which signature help depends on, is verified by parser.test.ts)
- If any of those conditions fail: **FAIL** with specific reason

**FUNC-07 (Go-to-definition):** Determine result as follows:
- If lsp-features.test.ts contains a direct DefinitionProvider test that passes: **PASS - Direct automated test** (cite test name)
- If no direct test: **PASS - Verified by linking.test.ts** ONLY IF:
  1. `linking.test.ts` passes its 11 non-interop tests (library definitions, symbolic labels, string template members, named lib parameters, MSGBOX params, compound statement scoping, enter verb scoping, case-insensitive BBjAPI, linking errors as warnings, field vs method disambiguation, string literal type)
  2. These tests verify `findLinkingErrors(document)` returns empty, proving reference resolution works
  3. Go-to-definition is a direct consumer of the reference resolution system tested by linking.test.ts
- If linking.test.ts has failures: **FAIL** with specific failing test names

## Chevrotain Token Verification

| Token | Standalone | Compound | Result |
|-------|-----------|----------|--------|
| READ | PASS/FAIL | PASS/FAIL | PASS/FAIL |
| INPUT | PASS/FAIL | PASS/FAIL | PASS/FAIL |
| ENTER | PASS/FAIL | PASS/FAIL | PASS/FAIL |
| EXTRACT | PASS/FAIL | PASS/FAIL | PASS/FAIL |
| DELETE | PASS/FAIL | PASS/FAIL | PASS/FAIL |
| SAVE | PASS/FAIL | PASS/FAIL | PASS/FAIL |
| FIND | PASS/FAIL | PASS/FAIL | PASS/FAIL |

## Release Artifacts

| Artifact | Status | File | Size |
|----------|--------|------|------|
| VS Code .vsix | PASS/FAIL | [filename] | [size] |
| IntelliJ .zip | PASS/FAIL | [filename] | [size] |

## Out of Scope (User-Handled)

Per Phase 18 CONTEXT.md locked decisions:
- **RELS-01**: VS Code publishing -- user runs `vsce publish` after version bump
- **RELS-02**: IntelliJ publishing -- user uploads to JetBrains marketplace after version bump
- **RELS-03**: Version bumps -- user handles all version changes in package.json, build.gradle.kts, etc.

These requirements are NOT verified by Phase 18. They are user responsibilities executed after this phase completes.

## Test Suite Summary

- Total tests: [N]
- Passed: [N]
- Failed: [N]
- Known failures: [describe any pre-existing failures]

## Conclusion

[Overall assessment: ready/not-ready for release]
[Any regressions found: none / list]
[Recommendation: proceed with version bump and publish / fix gaps first]
```

Fill in all PASS/FAIL values based on actual test run results and build output. Use the pre-defined verification methods above for FUNC-05, FUNC-06, FUNC-07 -- do NOT invent ad-hoc criteria at execution time.

IMPORTANT: If ANY feature is FAIL, document it clearly but do NOT attempt to fix it. Per Phase 18 CONTEXT.md: "If a feature doesn't work: route back to Phase 17 as gaps (don't fix in Phase 18)."
  </action>
  <verify>
1. `.vsix` file exists in `bbj-vscode/` directory
2. `.zip` file exists in `bbj-intellij/build/distributions/`
3. Verification report exists at `.planning/phases/18-functional-verification-release/18-VERIFICATION-REPORT.md`
4. Report contains PASS/FAIL for all 9 FUNC requirements (FUNC-01 through FUNC-09) plus PENDING for FUNC-10
5. Report contains Chevrotain token results for all 7 tokens
6. Report contains artifact details (filename, size)
7. Report contains "Out of Scope" section explicitly documenting RELS-01, RELS-02, RELS-03 as user-handled
  </verify>
  <done>Both release artifacts build successfully. Verification report documents pass/fail for all 9 VS Code features (using pre-defined verification methods for FUNC-05/06/07) and Chevrotain tokens. RELS-01/02/03 explicitly documented as out of scope (user-handled). FUNC-10 is PENDING for user checkpoint.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: IntelliJ runtime verification</name>
  <what-built>
Complete Langium 4 upgrade with:
- All automated functional tests passing (Chevrotain tokens + LSP features)
- VS Code .vsix package built
- IntelliJ .zip plugin built with updated language server bundle

The verification report at `.planning/phases/18-functional-verification-release/18-VERIFICATION-REPORT.md` documents the automated test results.
  </what-built>
  <how-to-verify>
IntelliJ runtime testing (FUNC-10). Install the built plugin and verify:

1. Install plugin: IntelliJ > Settings > Plugins > Gear icon > Install Plugin from Disk > select `bbj-intellij/build/distributions/bbj-intellij-*.zip`
2. Open a BBj project or create a new file with `.bbj` extension
3. Verify these features work (no regressions from before the upgrade):
   - [ ] Syntax highlighting: Keywords colored, strings colored, comments colored
   - [ ] Diagnostics: Introduce a syntax error, red squiggle appears
   - [ ] Code completion: Type a partial BBj keyword, completions appear
   - [ ] Hover: Hover over a BBj keyword or variable, info popup appears
   - [ ] Document outline: Structure view shows classes, methods, labels
4. Check the verification report for any FAIL items that need attention

If any feature is broken, describe the issue. These will be routed back as Phase 17 gaps.
  </how-to-verify>
  <resume-signal>Type "approved" if all features work, or describe any regressions found</resume-signal>
</task>

</tasks>

<verification>
1. VS Code .vsix artifact exists and contains main.cjs
2. IntelliJ .zip artifact exists and contains main.cjs
3. Verification report covers all FUNC requirements with evidence
4. FUNC-05, FUNC-06, FUNC-07 each verified using pre-defined methods (not ad-hoc)
5. RELS-01, RELS-02, RELS-03 explicitly documented as out of scope (user-handled)
6. User has confirmed IntelliJ runtime works (checkpoint approved)
7. Zero regressions identified across all features
</verification>

<success_criteria>
- Both release artifacts build without errors
- Verification report shows PASS for FUNC-01 through FUNC-09 (automated, using pre-defined methods)
- RELS-01, RELS-02, RELS-03 documented as N/A (user responsibility, not Phase 18 scope)
- User confirms FUNC-10 (IntelliJ runtime) at checkpoint
- Zero regressions: every feature works identically to pre-upgrade behavior
- Phase 18 is complete: ready for user to version-bump and publish
</success_criteria>

<output>
After completion, create `.planning/phases/18-functional-verification-release/18-02-SUMMARY.md`
</output>
