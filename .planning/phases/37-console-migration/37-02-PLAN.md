---
phase: 37-console-migration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-vscode/src/language/main.ts
  - bbj-vscode/src/language/bbj-scope-local.ts
  - bbj-vscode/src/language/bbj-scope.ts
  - bbj-vscode/src/language/bbj-linker.ts
  - bbj-vscode/src/language/bbj-module.ts
  - bbj-vscode/src/language/bbj-hover.ts
  - bbj-vscode/src/language/bbj-document-builder.ts
  - bbj-vscode/src/document-formatter.ts
autonomous: true

must_haves:
  truths:
    - "Zero console.log/debug/warn calls remain in any server-side production TypeScript file (excluding logger.ts internals)"
    - "All console.error() calls across the entire codebase remain untouched"
    - "extension.ts (client-side) console calls remain untouched"
    - "Test files console calls remain untouched"
    - "With debug OFF, no verbose output appears from any server file"
    - "With debug ON, debug-level messages from all files appear with timestamps"
  artifacts:
    - path: "bbj-vscode/src/language/main.ts"
      provides: "Logger-based output for settings change notification"
      contains: "logger.info"
    - path: "bbj-vscode/src/language/bbj-scope-local.ts"
      provides: "Logger-based output for Java class resolution"
      contains: "import { logger }"
    - path: "bbj-vscode/src/language/bbj-scope.ts"
      provides: "Logger-based output for scope warnings"
      contains: "import { logger }"
    - path: "bbj-vscode/src/language/bbj-linker.ts"
      provides: "Logger-based output for slow linking diagnostics"
      contains: "import { logger }"
    - path: "bbj-vscode/src/language/bbj-module.ts"
      provides: "Logger-based output for parser ambiguity notice"
      contains: "import { logger }"
    - path: "bbj-vscode/src/language/bbj-hover.ts"
      provides: "Logger-based output for hover errors"
      contains: "import { logger }"
    - path: "bbj-vscode/src/language/bbj-document-builder.ts"
      provides: "Logger-based output for import depth warnings"
      contains: "import { logger }"
    - path: "bbj-vscode/src/document-formatter.ts"
      provides: "Logger-based output for formatter warnings"
      contains: "import { logger }"
  key_links:
    - from: "bbj-vscode/src/language/bbj-scope-local.ts"
      to: "bbj-vscode/src/language/logger.ts"
      via: "import { logger }"
      pattern: "logger\\.(warn|debug)\\("
    - from: "bbj-vscode/src/language/bbj-linker.ts"
      to: "bbj-vscode/src/language/logger.ts"
      via: "import { logger }"
      pattern: "logger\\.debug\\("
    - from: "bbj-vscode/src/document-formatter.ts"
      to: "bbj-vscode/src/language/logger.ts"
      via: "import { logger }"
      pattern: "logger\\.(warn|info)\\("
---

<objective>
Migrate all remaining console.log/debug/warn calls across the 8 lower-volume server files to logger equivalents, completing the full codebase migration.

Purpose: After Plan 01 migrates the high-volume files, this plan eliminates all remaining console.log/debug/warn calls in production server code. Combined with Plan 01, this achieves LOG-04 (all console calls routed through logger).

Output: Eight modified source files with zero remaining console.log/debug/warn calls. The entire server codebase now respects the bbj.debug flag.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-logger-infrastructure/35-01-SUMMARY.md
@.planning/phases/36-settings-plumbing/36-01-SUMMARY.md

@bbj-vscode/src/language/logger.ts
@bbj-vscode/src/language/main.ts
@bbj-vscode/src/language/bbj-scope-local.ts
@bbj-vscode/src/language/bbj-scope.ts
@bbj-vscode/src/language/bbj-linker.ts
@bbj-vscode/src/language/bbj-module.ts
@bbj-vscode/src/language/bbj-hover.ts
@bbj-vscode/src/language/bbj-document-builder.ts
@bbj-vscode/src/document-formatter.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate main.ts, bbj-scope-local.ts, and bbj-scope.ts console calls</name>
  <files>bbj-vscode/src/language/main.ts, bbj-vscode/src/language/bbj-scope-local.ts, bbj-vscode/src/language/bbj-scope.ts</files>
  <action>
**main.ts (1 non-error call to migrate):**

NOTE: main.ts already has `import { logger, LogLevel } from './logger.js';` from Phase 36. Do NOT add a duplicate import.

- Line 120: `console.log('BBj settings changed, refreshing Java classes...')` → `logger.info('BBj settings changed, refreshing Java classes...')` (essential: user-initiated action feedback)

DO NOT TOUCH the 2 `console.error()` calls (lines 57, 149).

**bbj-scope-local.ts (4 non-error calls to migrate):**

Add `import { logger } from './logger.js';` to top of file with other imports.

- Line 158: `console.warn(`Java '${javaClassName}' class resolution error: ${javaClass.error}`)` → `logger.warn(`Java '${javaClassName}' class resolution error: ${javaClass.error}`)` (warning 1:1)
- Line 165: `console.warn(`Error processing USE statement for ${getFQNFullname(node.javaClass)}: ${e}`)` → `logger.warn(`Error processing USE statement for ${getFQNFullname(node.javaClass)}: ${e}`)` (warning 1:1)
- Line 275: `console.debug(`Java class ${classFqn}, check it is resolved.`)` → `logger.debug(`Java class ${classFqn}, check it is resolved.`)` (verbose 1:1)
- Line 329: `console.warn(e)` → `logger.warn(String(e))` (warning; wrap `e` in String() since logger expects string, not unknown)

DO NOT TOUCH the 1 `console.error()` call (line 333).

**bbj-scope.ts (2 non-error calls to migrate):**

Add `import { logger } from './logger.js';` to top of file with other imports.

- Line 141: `console.warn(`JavaDocument without classesMapScope.`)` → `logger.warn('JavaDocument without classesMapScope.')` (warning 1:1)
- Line 143: `console.warn(`Resolving JavaMember from outside of JavaDocument.`)` → `logger.warn('Resolving JavaMember from outside of JavaDocument.')` (warning 1:1)

DO NOT TOUCH the 1 `console.error()` call (line 150).
  </action>
  <verify>
1. `npx tsc --noEmit` — zero TypeScript errors
2. `grep -n 'console\.\(log\|debug\|warn\)(' bbj-vscode/src/language/main.ts` — zero matches
3. `grep -n 'console\.\(log\|debug\|warn\)(' bbj-vscode/src/language/bbj-scope-local.ts` — zero matches
4. `grep -n 'console\.\(log\|debug\|warn\)(' bbj-vscode/src/language/bbj-scope.ts` — zero matches
5. `grep -n 'console\.error(' bbj-vscode/src/language/main.ts` — 2 matches (untouched)
6. `grep -n 'console\.error(' bbj-vscode/src/language/bbj-scope-local.ts` — 1 match (untouched)
7. `grep -n 'console\.error(' bbj-vscode/src/language/bbj-scope.ts` — 1 match (untouched)
8. `npm test` — all tests pass
  </verify>
  <done>main.ts, bbj-scope-local.ts, and bbj-scope.ts have zero console.log/debug/warn calls. All console.error preserved. main.ts uses existing logger import (no duplicate). bbj-scope-local.ts and bbj-scope.ts import logger. TypeScript compiles, all tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate bbj-linker.ts, bbj-module.ts, bbj-hover.ts, bbj-document-builder.ts, and document-formatter.ts console calls</name>
  <files>bbj-vscode/src/language/bbj-linker.ts, bbj-vscode/src/language/bbj-module.ts, bbj-vscode/src/language/bbj-hover.ts, bbj-vscode/src/language/bbj-document-builder.ts, bbj-vscode/src/document-formatter.ts</files>
  <action>
Add `import { logger } from './logger.js';` to each of these 5 files (top of file, with other imports). For document-formatter.ts, use the correct relative path: `import { logger } from './language/logger.js';` (it's in src/, not src/language/).

**bbj-linker.ts (1 non-error call to migrate):**

- Line 65: `console.debug(`Linking (>${threshold}ms) ${document.uri} took ${elapsed}ms`)` → `logger.debug(`Linking (>${threshold}ms) ${document.uri} took ${elapsed}ms`)` (verbose performance diagnostic 1:1)

**bbj-module.ts (1 non-error call to migrate):**

- Line 113: `console.debug('Parser: Ambiguous Alternatives Detected. Enable ambiguity logging to see details.')` → `logger.debug('Parser: Ambiguous Alternatives Detected. Enable ambiguity logging to see details.')` (verbose parser diagnostic 1:1)

**bbj-hover.ts (1 non-error call to migrate):**

- Line 119: `console.warn(e)` → `logger.warn(String(e))` (warning; wrap `e` in String() since logger expects string, not unknown)

**bbj-document-builder.ts (2 non-error calls to migrate):**

- Line 109: `console.warn(`[PREFIX] Maximum transitive import depth (${BBjDocumentBuilder.MAX_IMPORT_DEPTH}) reached. Stopping USE resolution.`)` → `logger.warn(`Maximum transitive import depth (${BBjDocumentBuilder.MAX_IMPORT_DEPTH}) reached. Stopping USE resolution.`)` (warning 1:1; remove [PREFIX] tag since logger handles tagging)
- Line 156: `console.warn(`[PREFIX] Skipping binary/tokenized file: ${docFileData.uri.fsPath}`)` → `logger.warn(`Skipping binary/tokenized file: ${docFileData.uri.fsPath}`)` (warning 1:1; remove [PREFIX] tag)

**document-formatter.ts (2 non-error calls to migrate):**

- Line 42: `console.log(err)` → `logger.warn(String(err))` (error during formatting — not console.error because it's a handled/expected error, but warn level since it indicates something went wrong)
- Line 75: `console.log(`Formatting took too long (${timeTaken}ms). Format On Save feature could be aborted.`)` → `logger.warn(`Formatting took too long (${timeTaken}ms). Format On Save feature could be aborted.`)` (performance warning — warn level since it indicates degraded UX)
  </action>
  <verify>
1. `npx tsc --noEmit` — zero TypeScript errors
2. `grep -n 'console\.\(log\|debug\|warn\)(' bbj-vscode/src/language/bbj-linker.ts` — zero matches
3. `grep -n 'console\.\(log\|debug\|warn\)(' bbj-vscode/src/language/bbj-module.ts` — zero matches
4. `grep -n 'console\.\(log\|debug\|warn\)(' bbj-vscode/src/language/bbj-hover.ts` — zero matches
5. `grep -n 'console\.\(log\|debug\|warn\)(' bbj-vscode/src/language/bbj-document-builder.ts` — zero matches
6. `grep -n 'console\.\(log\|debug\|warn\)(' bbj-vscode/src/document-formatter.ts` — zero matches
7. `grep -c "import.*logger" bbj-vscode/src/language/bbj-linker.ts bbj-vscode/src/language/bbj-module.ts bbj-vscode/src/language/bbj-hover.ts bbj-vscode/src/language/bbj-document-builder.ts bbj-vscode/src/document-formatter.ts` — each file shows 1
8. `npm test` — all tests pass
  </verify>
  <done>bbj-linker.ts, bbj-module.ts, bbj-hover.ts, bbj-document-builder.ts, and document-formatter.ts have zero console.log/debug/warn calls. All files import logger with correct relative path. Performance diagnostics use logger.debug, warnings use logger.warn. [PREFIX] tags removed from bbj-document-builder.ts messages. TypeScript compiles, all tests pass.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — zero TypeScript compilation errors across entire project
2. `npm test` — all existing tests pass (no regressions)
3. Full codebase scan for remaining console.log/debug/warn in server production code:
   `grep -rn 'console\.\(log\|debug\|warn\)(' bbj-vscode/src/language/ --include='*.ts' | grep -v logger.ts` — zero matches
   `grep -rn 'console\.\(log\|debug\|warn\)(' bbj-vscode/src/document-formatter.ts` — zero matches
4. Verify console.error preserved:
   `grep -rn 'console\.error(' bbj-vscode/src/language/ --include='*.ts' | grep -v logger.ts` — all original console.error calls remain
5. Verify logger imports added to all migrated files:
   `grep -rn "import.*logger" bbj-vscode/src/language/ --include='*.ts' | grep -v logger.ts | grep -v test` — matches for all migrated files
6. Verify exclusions are clean:
   `grep -n 'console\.' bbj-vscode/src/extension.ts` — only console.error (client-side, untouched)
   `grep -n 'logger\.' bbj-vscode/src/extension.ts` — zero matches (client-side, no logger import)
</verification>

<success_criteria>
- Zero console.log/debug/warn calls remain in ANY server-side production TypeScript file (excluding logger.ts internal implementation)
- All console.error calls preserved untouched across entire codebase
- Logger import present in all 8 modified files with correct relative paths
- main.ts uses existing logger import from Phase 36 (no duplicate)
- document-formatter.ts uses correct path: './language/logger.js'
- String() wrapper used for `e` arguments that are typed as unknown
- [PREFIX] tags removed from bbj-document-builder.ts messages
- extension.ts (client-side) completely untouched
- Test files completely untouched
- TypeScript compiles with zero errors
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/37-console-migration/37-02-SUMMARY.md`
</output>
