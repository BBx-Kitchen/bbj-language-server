---
phase: 49-fix-deprecated-apis-and-verify
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjLanguageCodeStyleSettingsProvider.java
autonomous: true

must_haves:
  truths:
    - "BbjRunActionBase uses ProcessListener interface instead of ProcessAdapter class"
    - "BbjLanguageCodeStyleSettingsProvider uses customizeDefaults() instead of getDefaultCommonSettings()"
    - "Project compiles successfully with zero errors"
    - "Plugin verifier reports 0 scheduled-for-removal API usages"
    - "Plugin verifier reports 0 deprecated API usages"
  artifacts:
    - path: "bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java"
      provides: "Process listener using ProcessListener interface"
      contains: "new ProcessListener()"
    - path: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjLanguageCodeStyleSettingsProvider.java"
      provides: "Code style defaults via customizeDefaults method"
      contains: "customizeDefaults"
  key_links:
    - from: "BbjRunActionBase.java"
      to: "ProcessListener interface"
      via: "import and anonymous class instantiation"
      pattern: "import com\\.intellij\\.execution\\.process\\.ProcessListener"
    - from: "BbjLanguageCodeStyleSettingsProvider.java"
      to: "LanguageCodeStyleSettingsProvider.customizeDefaults"
      via: "method override"
      pattern: "void customizeDefaults"
---

<objective>
Replace the 2 remaining deprecated IntelliJ Platform APIs with current equivalents and run the plugin verifier to confirm zero compatibility issues.

Purpose: Achieve zero deprecated and scheduled-for-removal API usages, ensuring forward compatibility with IntelliJ 2026.1+ and completing the v3.6 milestone.
Output: Two modified Java files with current API usage, plugin verifier passing clean.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/48-fix-scheduled-for-removal-apis/48-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace ProcessAdapter with ProcessListener and getDefaultCommonSettings with customizeDefaults</name>
  <files>
    bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java
    bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjLanguageCodeStyleSettingsProvider.java
  </files>
  <action>
**BbjRunActionBase.java (COMPAT-05):**
1. Replace `import com.intellij.execution.process.ProcessAdapter;` with `import com.intellij.execution.process.ProcessListener;`
2. On line 72, replace `new ProcessAdapter() {` with `new ProcessListener() {`
3. Update the comment on line 71 from "Attach ProcessAdapter" to "Attach ProcessListener"
4. Do NOT change any method signatures or behavior inside the anonymous class. Both `onTextAvailable` and `processTerminated` are default methods on ProcessListener, so the anonymous class body stays identical.

**BbjLanguageCodeStyleSettingsProvider.java (COMPAT-06):**
1. Remove the `getDefaultCommonSettings()` method override entirely (lines 21-26)
2. Add a new override of `customizeDefaults`:
```java
@Override
protected void customizeDefaults(@NotNull CommonCodeStyleSettings commonSettings,
                                  @NotNull CommonCodeStyleSettings.IndentOptions indentOptions) {
    commonSettings.LINE_COMMENT_AT_FIRST_COLUMN = true;
    commonSettings.BLOCK_COMMENT_AT_FIRST_COLUMN = true;
}
```
3. Add `import com.intellij.psi.codeStyle.CommonCodeStyleSettings;` if not already a standalone import (it is currently used but only via the method return type — verify the import is explicit, not just via the class usage)
4. Keep the existing `getLanguage()` and `getCodeSample()` overrides unchanged
5. The key difference: `getDefaultCommonSettings()` created a new CommonCodeStyleSettings object and returned it. `customizeDefaults()` receives an already-created object and mutates it directly. Do NOT create a new CommonCodeStyleSettings object.
  </action>
  <verify>
1. `cd /Users/beff/_workspace/bbj-language-server/bbj-intellij && ./gradlew compileJava` succeeds
2. `grep -r "ProcessAdapter" bbj-intellij/src/` returns no matches
3. `grep -r "getDefaultCommonSettings" bbj-intellij/src/` returns no matches
4. `grep -r "ProcessListener" bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java` shows import and usage
5. `grep -r "customizeDefaults" bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjLanguageCodeStyleSettingsProvider.java` shows override
  </verify>
  <done>
BbjRunActionBase uses ProcessListener interface (not ProcessAdapter class) for process event handling. BbjLanguageCodeStyleSettingsProvider uses customizeDefaults() (not getDefaultCommonSettings()) for code style configuration. Both files compile without errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Run plugin verifier and confirm zero compatibility issues</name>
  <files></files>
  <action>
1. Run the IntelliJ plugin verifier: `cd /Users/beff/_workspace/bbj-language-server/bbj-intellij && ./gradlew verifyPlugin`
2. This task downloads multiple IntelliJ IDE versions and checks the compiled plugin against them. It may take several minutes. Set a 10-minute timeout.
3. Examine the verifier output for:
   - "Deprecated API usages" section — should report 0 for our plugin code (LSP4IJ experimental API usages are expected and out of scope)
   - "Scheduled for removal API usages" section — should report 0
4. If the verifier reports deprecated/scheduled-for-removal API usages IN OUR CODE (com.basis.bbj package), identify the issue and fix it before proceeding.
5. Note: The verifier may report "Experimental API usages" from LSP4IJ — these are expected and out of scope (EXP-01/EXP-02 in requirements).

IMPORTANT: The verifier task requires the language server bundle to exist at `bbj-vscode/out/language/main.cjs`. If the build fails because this file is missing, run `cd /Users/beff/_workspace/bbj-language-server/bbj-vscode && npm run langium:generate && npm run build` first, then retry the verifier.
  </action>
  <verify>
1. `./gradlew verifyPlugin` completes successfully (exit code 0)
2. Verifier output shows 0 "Deprecated API usages" from com.basis.bbj package
3. Verifier output shows 0 "Scheduled for removal API usages" from com.basis.bbj package
  </verify>
  <done>
Plugin verifier confirms zero deprecated and zero scheduled-for-removal API usages in the BBj plugin code. VERIFY-01 and VERIFY-02 requirements satisfied. The v3.6 milestone goal of zero compatibility warnings is achieved.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify the full phase goal:

1. **COMPAT-05**: `grep -rn "ProcessListener" bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java` shows import and usage (not ProcessAdapter)
2. **COMPAT-06**: `grep -rn "customizeDefaults" bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjLanguageCodeStyleSettingsProvider.java` shows method override (not getDefaultCommonSettings)
3. **VERIFY-01**: Plugin verifier reports 0 scheduled-for-removal API usages
4. **VERIFY-02**: Plugin verifier reports 0 deprecated API usages
5. **Compilation**: `./gradlew compileJava` succeeds with zero errors
</verification>

<success_criteria>
- BbjRunActionBase.java uses ProcessListener interface directly (ProcessAdapter import and usage completely removed)
- BbjLanguageCodeStyleSettingsProvider.java overrides customizeDefaults() (getDefaultCommonSettings() override completely removed)
- Plugin compiles without errors
- Plugin verifier reports zero deprecated and zero scheduled-for-removal API usages in com.basis.bbj package
- All 4 Phase 49 requirements (COMPAT-05, COMPAT-06, VERIFY-01, VERIFY-02) are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/49-fix-deprecated-apis-and-verify/49-01-SUMMARY.md`
</output>
