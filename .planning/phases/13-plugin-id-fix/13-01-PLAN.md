---
phase: 13-plugin-id-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/lsp/BbjLanguageServer.java
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All PluginId.getId() calls in Java source use 'com.basis.bbj' matching plugin.xml <id>"
    - "BUI/DWC run commands can resolve web.bbj path from plugin bundle in production installs"
    - "Language server resolves main.cjs via plugin path (not classloader fallback) in production installs"
    - "Plugin verifier still passes with zero compatibility errors after fix"
    - "Distribution ZIP rebuilt with corrected classes"
  artifacts:
    - path: "bbj-intellij/src/main/java/com/basis/bbj/intellij/lsp/BbjLanguageServer.java"
      provides: "Language server path resolution via correct plugin ID"
      contains: 'PluginId.getId("com.basis.bbj")'
    - path: "bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java"
      provides: "web.bbj path resolution via correct plugin ID"
      contains: 'PluginId.getId("com.basis.bbj")'
  key_links:
    - from: "BbjLanguageServer.java:resolveServerPath()"
      to: "plugin.xml <id>com.basis.bbj</id>"
      via: "PluginId.getId() string must match plugin.xml ID"
      pattern: 'PluginId\.getId\("com\.basis\.bbj"\)'
    - from: "BbjRunActionBase.java:getWebBbjPath()"
      to: "plugin.xml <id>com.basis.bbj</id>"
      via: "PluginId.getId() string must match plugin.xml ID"
      pattern: 'PluginId\.getId\("com\.basis\.bbj"\)'
---

<objective>
Fix plugin ID mismatch in two Java source files and rebuild the distribution.

Purpose: Phase 12 commit 5add12d changed plugin.xml ID from "com.basis.bbj.intellij" to "com.basis.bbj" per Marketplace naming rules, but two hardcoded PluginId.getId() calls still reference the old ID. This breaks BUI/DWC run commands entirely and degrades LS startup (falls back to temp file extraction) in production Marketplace installs.

Output: Two corrected Java files, clean build, passing plugin verifier, rebuilt distribution ZIP.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/v1.2-MILESTONE-AUDIT.md
@bbj-intellij/src/main/resources/META-INF/plugin.xml
@bbj-intellij/src/main/java/com/basis/bbj/intellij/lsp/BbjLanguageServer.java
@bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix PluginId.getId() callsites and rebuild distribution</name>
  <files>
    bbj-intellij/src/main/java/com/basis/bbj/intellij/lsp/BbjLanguageServer.java
    bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java
  </files>
  <action>
    Two string literal changes:

    1. In BbjLanguageServer.java line 70, change:
       `PluginId pluginId = PluginId.getId("com.basis.bbj.intellij");`
       to:
       `PluginId pluginId = PluginId.getId("com.basis.bbj");`

    2. In BbjRunActionBase.java line 231, change:
       `com.intellij.openapi.extensions.PluginId.getId("com.basis.bbj.intellij")`
       to:
       `com.intellij.openapi.extensions.PluginId.getId("com.basis.bbj")`

    After making the changes:

    3. Grep the entire bbj-intellij/src directory for any remaining references to "com.basis.bbj.intellij" — there should be ZERO matches (the old ID should not appear anywhere in source).

    4. Run `./gradlew :bbj-intellij:buildPlugin` to rebuild the plugin distribution.

    5. Run `./gradlew :bbj-intellij:verifyPlugin` to confirm plugin verifier still passes with zero compatibility errors.

    Do NOT change the plugin.xml — it already has the correct ID "com.basis.bbj".
    Do NOT touch build.gradle.kts — no build config changes needed.
  </action>
  <verify>
    1. `grep -r "com.basis.bbj.intellij" bbj-intellij/src/` returns zero matches
    2. `grep -r 'PluginId.getId("com.basis.bbj")' bbj-intellij/src/` returns exactly 2 matches (one per file)
    3. `./gradlew :bbj-intellij:buildPlugin` completes with BUILD SUCCESSFUL
    4. `./gradlew :bbj-intellij:verifyPlugin` completes with zero compatibility errors
    5. Distribution ZIP exists at bbj-intellij/build/distributions/
  </verify>
  <done>
    - Both PluginId.getId() calls use "com.basis.bbj" matching plugin.xml
    - Zero references to old "com.basis.bbj.intellij" ID remain in source
    - Plugin builds and verifies cleanly
    - Distribution ZIP is rebuilt with corrected classes
  </done>
</task>

</tasks>

<verification>
1. No references to old plugin ID "com.basis.bbj.intellij" in any Java source file
2. Both PluginId.getId() calls match plugin.xml `<id>com.basis.bbj</id>`
3. Gradle buildPlugin succeeds
4. Gradle verifyPlugin reports zero compatibility errors
5. Fresh distribution ZIP exists in build/distributions/
</verification>

<success_criteria>
- BbjLanguageServer.resolveServerPath() will find plugin via correct ID in production installs (primary path succeeds, no temp file fallback needed)
- BbjRunActionBase.getWebBbjPath() will find plugin via correct ID in production installs (web.bbj resolved, BUI/DWC run commands work)
- Plugin verifier passes with zero errors (no regressions from the fix)
- Distribution ZIP rebuilt and ready for Marketplace submission
</success_criteria>

<output>
After completion, create `.planning/phases/13-plugin-id-fix/13-01-SUMMARY.md`
</output>
