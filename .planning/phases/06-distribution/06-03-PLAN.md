---
phase: 06-distribution
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Plugin ZIP installs on fresh IntelliJ without errors via Install Plugin from Disk"
    - "After install from ZIP, syntax highlighting works on BBj files"
    - "After install from ZIP, language server starts and provides diagnostics, completion, hover"
    - "After install from ZIP, java-interop status widget appears and connects"
    - "Welcome notification appears on first launch after install"
    - "Missing Node.js banner offers Download Node.js action"
  artifacts: []
  key_links: []
---

<objective>
Build the plugin ZIP, install it on a fresh IntelliJ instance, and verify that all Phase 4 (LSP) and Phase 5 (Java Interop) features work identically to the development sandbox. Verify cross-platform readiness.

Purpose: Ensure the distributable plugin actually works when installed from disk, validating the entire packaging pipeline end-to-end.
Output: Verified plugin installation with all features working, or bug fixes if issues are discovered.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-distribution/06-01-SUMMARY.md
@.planning/phases/06-distribution/06-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build final plugin ZIP and verify structure</name>
  <files></files>
  <action>
1. Run `cd bbj-intellij && ./gradlew clean buildPlugin`
2. Verify ZIP exists at `build/distributions/bbj-intellij-0.1.0-alpha.zip`
3. Unzip to a temp directory and verify the directory structure:
   ```
   bbj-intellij/
   ├── lib/
   │   ├── bbj-intellij-0.1.0-alpha.jar
   │   ├── language-server/
   │   │   └── main.cjs
   │   └── textmate/
   │       └── bbj-bundle/
   │           ├── package.json
   │           ├── syntaxes/bbj.tmLanguage.json
   │           ├── syntaxes/bbx.tmLanguage.json
   │           ├── bbj-language-configuration.json
   │           └── bbx-language-configuration.json
   ```
4. Verify the JAR contains META-INF/plugin.xml with correct vendor
5. Verify the JAR contains META-INF/description.html
6. Verify the JAR contains META-INF/pluginIcon.svg
7. Report the ZIP file size

If any structural issues are found, fix them in build.gradle.kts or related files before proceeding to human verification.
  </action>
  <verify>
All listed files present in ZIP. ZIP size is reasonable (< 5MB, since main.cjs is ~1.8MB).
  </verify>
  <done>
Plugin ZIP has correct structure with language server, TextMate grammars, and all metadata files.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete plugin distribution ZIP with bundled language server, TextMate grammars, marketplace metadata, welcome notification, and Node.js download capability.
  </what-built>
  <how-to-verify>
**Installation Test (macOS):**

1. Open a FRESH IntelliJ IDEA instance (not the dev sandbox)
2. Go to Settings > Plugins > Gear icon > "Install Plugin from Disk..."
3. Select `bbj-intellij/build/distributions/bbj-intellij-0.1.0-alpha.zip`
4. Restart IntelliJ when prompted
5. After restart, check:

**Phase 4 Features (Language Server):**
- [ ] Open a BBj file — syntax highlighting appears immediately
- [ ] Status bar shows "BBj LS: Running" after a moment
- [ ] Syntax errors show red underlines
- [ ] Typing triggers code completion popup
- [ ] Ctrl+Click (Cmd+Click) navigates to declaration
- [ ] Hover shows function documentation
- [ ] Tools > "Restart BBj Language Server" works

**Phase 5 Features (Java Interop):**
- [ ] Java-interop status widget appears in status bar
- [ ] If BBjServices is running, widget shows "Connected"
- [ ] If BBjServices is NOT running, editor banner warns about it

**Phase 6 Features (Distribution):**
- [ ] Welcome notification appeared on first launch with "Open Settings" link
- [ ] Clicking "Open Settings" opens BBj settings page
- [ ] Settings page shows BBj Home, Node.js path, classpath fields

**Node.js Download (if applicable — test ONLY if system Node.js is removed/renamed):**
- [ ] Missing Node.js banner shows "Download Node.js" action
- [ ] Clicking download starts background download with progress
- [ ] After download, LS starts using downloaded Node.js

**Cross-Platform Notes:**
- Windows and Linux testing will be done manually by the developer later
- For this checkpoint, only macOS verification is required
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found for fixing.</resume-signal>
</task>

</tasks>

<verification>
All Phase 4 and Phase 5 success criteria verified working from disk-installed plugin:
1. Plugin ZIP includes bundled language server (main.cjs) in correct directory structure
2. Plugin ZIP installs via "Install Plugin from Disk" without errors
3. After installation from ZIP, all features work identically to development sandbox
4. macOS verified; Windows/Linux deferred to developer manual testing
</verification>

<success_criteria>
- Plugin installs cleanly from ZIP on fresh IntelliJ instance
- All existing LSP features work (diagnostics, completion, navigation, hover)
- Java-interop status widget works
- Welcome notification fires on first launch
- No regressions from development sandbox behavior
</success_criteria>

<output>
After completion, create `.planning/phases/06-distribution/06-03-SUMMARY.md`
</output>
