---
phase: 01-plugin-scaffolding
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjLanguage.java
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjFileType.java
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java
  - bbj-intellij/src/main/resources/icons/bbj.svg
  - bbj-intellij/src/main/resources/META-INF/plugin.xml
autonomous: true

must_haves:
  truths:
    - "IntelliJ IDEA Community Edition loads the plugin from sandbox without errors"
    - "BBj files (.bbj, .bbl, .bbjt, .src) appear with custom icon in Project view"
    - "Opening a BBj file creates an editor instance (even without syntax highlighting)"
    - "Plugin builds via ./gradlew buildPlugin and produces installable ZIP"
  artifacts:
    - path: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjLanguage.java"
      provides: "BBj language singleton registration"
      contains: "INSTANCE"
    - path: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjFileType.java"
      provides: "BBj file type with extension associations"
      contains: "INSTANCE"
    - path: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java"
      provides: "Icon constants for BBj file type"
      contains: "IconLoader.getIcon"
    - path: "bbj-intellij/src/main/resources/icons/bbj.svg"
      provides: "16x16 SVG icon for BBj files"
    - path: "bbj-intellij/src/main/resources/META-INF/plugin.xml"
      provides: "Plugin descriptor with fileType extension"
      contains: "fileType"
  key_links:
    - from: "bbj-intellij/src/main/resources/META-INF/plugin.xml"
      to: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjFileType.java"
      via: "fileType extension registration"
      pattern: "implementationClass.*BbjFileType"
    - from: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjFileType.java"
      to: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjLanguage.java"
      via: "super(BbjLanguage.INSTANCE)"
      pattern: "BbjLanguage\\.INSTANCE"
    - from: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjFileType.java"
      to: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java"
      via: "getIcon() returns BbjIcons.FILE"
      pattern: "BbjIcons\\.FILE"
    - from: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java"
      to: "bbj-intellij/src/main/resources/icons/bbj.svg"
      via: "IconLoader.getIcon resource path"
      pattern: "IconLoader\\.getIcon.*icons/bbj\\.svg"
---

<objective>
Create the BBj language, file type, and icon classes, register them in plugin.xml, and verify the complete plugin builds and produces an installable ZIP.

Purpose: This completes Phase 1 by making IntelliJ recognize BBj files with a custom icon. After this plan, opening any .bbj, .bbl, .bbjt, or .src file in IntelliJ will create an editor instance with the BBj file icon showing in the project tree.

Output: Three Java source files (BbjLanguage, BbjFileType, BbjIcons), an SVG icon, updated plugin.xml with fileType extension, and a verified buildPlugin ZIP.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-plugin-scaffolding/01-RESEARCH.md
@.planning/phases/01-plugin-scaffolding/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Java source files and SVG icon</name>
  <files>
    bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjLanguage.java
    bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjFileType.java
    bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java
    bbj-intellij/src/main/resources/icons/bbj.svg
  </files>
  <action>
    Create the Java package directory: `src/main/java/com/basis/bbj/intellij/` inside bbj-intellij/.

    Create `BbjLanguage.java` - the language singleton:
    ```java
    package com.basis.bbj.intellij;

    import com.intellij.lang.Language;

    public class BbjLanguage extends Language {
        public static final BbjLanguage INSTANCE = new BbjLanguage();

        private BbjLanguage() {
            super("BBj");
        }
    }
    ```

    Create `BbjIcons.java` - icon constants interface:
    ```java
    package com.basis.bbj.intellij;

    import com.intellij.openapi.util.IconLoader;
    import javax.swing.Icon;

    public interface BbjIcons {
        Icon FILE = IconLoader.getIcon("/icons/bbj.svg", BbjIcons.class);
    }
    ```

    IMPORTANT: The icon path MUST start with `/` (absolute resource path). Without the leading slash, IconLoader will fail to find the resource at runtime.

    Create `BbjFileType.java` - the file type singleton:
    ```java
    package com.basis.bbj.intellij;

    import com.intellij.openapi.fileTypes.LanguageFileType;
    import org.jetbrains.annotations.NotNull;
    import javax.swing.Icon;

    public final class BbjFileType extends LanguageFileType {
        public static final BbjFileType INSTANCE = new BbjFileType();

        private BbjFileType() {
            super(BbjLanguage.INSTANCE);
        }

        @NotNull
        @Override
        public String getName() {
            return "BBj";
        }

        @NotNull
        @Override
        public String getDescription() {
            return "BBj source file";
        }

        @NotNull
        @Override
        public String getDefaultExtension() {
            return "bbj";
        }

        @Override
        public Icon getIcon() {
            return BbjIcons.FILE;
        }
    }
    ```

    IMPORTANT:
    - Constructors MUST be private (singleton pattern).
    - `BbjFileType` MUST be `final` class.
    - `getName()` returns "BBj" which must match the `name` attribute in plugin.xml's fileType registration.

    Create SVG icon at `src/main/resources/icons/bbj.svg`. This should be a 16x16 SVG icon representing BBj. Create a simple, clean icon that uses the BBj "B" letterform. Use the existing bbj-vscode icon as inspiration (it's a stylized "B" shape). The icon should work on both light and dark IDE themes, so use a neutral color like #6B9BD2 (blue) that is visible on both backgrounds. IntelliJ recommends 16x16 with 1px transparent padding.

    Note: IntelliJ supports automatic dark theme icon variants by naming convention (bbj_dark.svg), but for Phase 1 a single icon is sufficient. A single SVG with a visible color on both backgrounds works fine.
  </action>
  <verify>
    Confirm all 4 files exist:
    - `ls bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjLanguage.java`
    - `ls bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjFileType.java`
    - `ls bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java`
    - `ls bbj-intellij/src/main/resources/icons/bbj.svg`

    Run `cd bbj-intellij && ./gradlew compileJava --no-daemon` and confirm Java compilation succeeds with no errors.
  </verify>
  <done>
    All three Java files compile successfully against IntelliJ Platform SDK. BbjLanguage has INSTANCE singleton. BbjFileType has INSTANCE singleton and returns BbjIcons.FILE from getIcon(). SVG icon file exists in resources/icons/.
  </done>
</task>

<task type="auto">
  <name>Task 2: Register fileType extension in plugin.xml and build plugin ZIP</name>
  <files>
    bbj-intellij/src/main/resources/META-INF/plugin.xml
  </files>
  <action>
    Update plugin.xml (created in Plan 01) to add the fileType extension registration inside an extensions block.

    The final plugin.xml should be:
    ```xml
    <idea-plugin>
        <id>com.basis.bbj.intellij</id>
        <name>BBj Language Support</name>
        <version>0.1.0</version>
        <vendor email="support@basis.cloud" url="https://basis.cloud">BASIS International</vendor>

        <description><![CDATA[
            BBj language support for IntelliJ IDEA. Provides file type recognition,
            syntax highlighting, and language server integration for BBj development.
        ]]></description>

        <idea-version since-build="242"/>

        <depends>com.intellij.modules.platform</depends>

        <extensions defaultExtensionNs="com.intellij">
            <fileType
                name="BBj"
                implementationClass="com.basis.bbj.intellij.BbjFileType"
                fieldName="INSTANCE"
                language="BBj"
                extensions="bbj;bbl;bbjt;src"/>
        </extensions>
    </idea-plugin>
    ```

    CRITICAL details:
    - `name="BBj"` MUST match `BbjFileType.getName()` return value exactly.
    - `fieldName="INSTANCE"` tells IntelliJ to use the singleton field instead of constructing a new instance.
    - `language="BBj"` MUST match the language ID passed to `BbjLanguage` constructor (`super("BBj")`).
    - `extensions="bbj;bbl;bbjt;src"` lists all four BBj file extensions separated by semicolons.
    - The `<extensions>` block uses `defaultExtensionNs="com.intellij"` which is required for all standard IntelliJ extension points.

    After updating plugin.xml, run the full buildPlugin task to produce the installable ZIP.
  </action>
  <verify>
    1. Run `cd bbj-intellij && ./gradlew buildPlugin --no-daemon` and confirm BUILD SUCCESSFUL.
    2. Confirm ZIP artifact exists: `ls bbj-intellij/build/distributions/*.zip` should show a ZIP file.
    3. Verify the ZIP contains the expected structure by listing its contents: `unzip -l bbj-intellij/build/distributions/*.zip` should show plugin.xml, the compiled classes, and the icon resource.
  </verify>
  <done>
    plugin.xml registers BbjFileType for extensions bbj/bbl/bbjt/src. `./gradlew buildPlugin` produces a ZIP in build/distributions/. The ZIP contains META-INF/plugin.xml, compiled Java classes, and the SVG icon resource. The plugin is installable via "Install Plugin from Disk" in IntelliJ.
  </done>
</task>

</tasks>

<verification>
1. `cd bbj-intellij && ./gradlew buildPlugin --no-daemon` completes with BUILD SUCCESSFUL
2. ZIP artifact exists in `bbj-intellij/build/distributions/`
3. ZIP contains: plugin.xml, BbjLanguage.class, BbjFileType.class, BbjIcons.class, bbj.svg
4. plugin.xml has fileType extension registering all 4 BBj file extensions
5. All Java classes follow singleton pattern with public static final INSTANCE field
6. BbjFileType.getName() returns "BBj" matching plugin.xml name attribute
7. BbjIcons.FILE loads from "/icons/bbj.svg" resource path
</verification>

<success_criteria>
- Plugin ZIP builds successfully and is installable
- All four BBj file extensions (.bbj, .bbl, .bbjt, .src) are registered
- File type has a custom SVG icon
- BbjLanguage registered with ID "BBj"
- All classes use singleton pattern (private constructor, INSTANCE field)
- Phase 1 success criteria met: IntelliJ recognizes BBj files with custom icon in a functional plugin structure
</success_criteria>

<output>
After completion, create `.planning/phases/01-plugin-scaffolding/01-02-SUMMARY.md`
</output>
