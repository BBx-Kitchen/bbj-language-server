---
phase: 25-type-resolution-crash-fixes
plan: 04
type: execute
wave: 3
depends_on: ["01", "02", "03"]
files_modified:
  - bbj-vscode/package.json
  - bbj-vscode/src/language/bbj-validator.ts
  - bbj-vscode/src/extension.ts
autonomous: true

must_haves:
  truths:
    - "A workspace setting 'bbj.typeResolution.warnings' exists and defaults to true (enabled)"
    - "When the setting is set to false, no type resolution warnings are emitted (CAST, USE, unresolvable super)"
    - "When the setting is true (default), all type resolution warnings work normally"
  artifacts:
    - path: "bbj-vscode/package.json"
      provides: "Configuration property for bbj.typeResolution.warnings"
      contains: "typeResolution"
    - path: "bbj-vscode/src/language/bbj-validator.ts"
      provides: "Setting check before emitting type resolution warnings"
      contains: "typeResolution"
  key_links:
    - from: "bbj-vscode/src/language/bbj-validator.ts"
      to: "package.json configuration"
      via: "reading bbj.typeResolution.warnings setting"
      pattern: "typeResolution.*warnings"
    - from: "bbj-vscode/src/extension.ts"
      to: "initializationOptions"
      via: "passing setting to language server"
      pattern: "typeResolution"
---

<objective>
Add a workspace setting to disable type resolution warnings entirely, for heavily dynamic codebases where these warnings would be noisy.

Purpose: Per user decision, there should be a workspace setting to disable type resolution warnings entirely. This covers all the new warning diagnostics added in Plans 01-03: CAST unresolvable type, USE unresolvable class, and unresolvable super class access. When disabled, these warnings are suppressed but the underlying crash fixes and type resolution logic still work.

Output: Updated `package.json` with new setting, updated `bbj-validator.ts` to check the setting before emitting warnings, updated `extension.ts` to pass the setting to the language server.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-type-resolution-crash-fixes/25-CONTEXT.md
@.planning/phases/25-type-resolution-crash-fixes/25-01-SUMMARY.md
@.planning/phases/25-type-resolution-crash-fixes/25-02-SUMMARY.md
@.planning/phases/25-type-resolution-crash-fixes/25-03-SUMMARY.md
@bbj-vscode/package.json
@bbj-vscode/src/language/bbj-validator.ts
@bbj-vscode/src/language/bbj-module.ts
@bbj-vscode/src/extension.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add workspace setting and integrate into validator</name>
  <files>bbj-vscode/package.json, bbj-vscode/src/language/bbj-validator.ts, bbj-vscode/src/extension.ts</files>
  <action>
**Add setting to package.json:**

In the `contributes.configuration.properties` section of `bbj-vscode/package.json`, add:

```json
"bbj.typeResolution.warnings": {
    "type": "boolean",
    "default": true,
    "description": "Enable/disable type resolution warnings (CAST, USE, inheritance). Disable for heavily dynamic codebases where these warnings are noisy.",
    "scope": "window"
}
```

Place it after the existing `bbj.formatter.*` settings or at the end of the properties block.

**Pass setting to language server via initializationOptions:**

In `extension.ts`, update the `initializationOptions` in the `clientOptions` to include the new setting:

```typescript
initializationOptions: {
    home: vscode.workspace.getConfiguration("bbj").home,
    classpath: vscode.workspace.getConfiguration("bbj").classpath,
    typeResolutionWarnings: vscode.workspace.getConfiguration("bbj").get("typeResolution.warnings", true)
}
```

**Read setting in the validator:**

The BBjValidator already receives `services: BBjServices` in the constructor. The language server receives `initializationOptions` via the LSP connection. To access the setting from within the validator:

Option A (simplest): Check the setting in the validator constructor by accessing the shared services' connection. However, the validator is instantiated during DI and may not have access to initialization params at construction time.

Option B (recommended): Add a `typeResolutionWarningsEnabled` property to `BBjValidator` that defaults to `true`. Set it from the language server startup after receiving initializationOptions. The BBjWorkspaceManager already receives initialization params in its `initializeWorkspace` method -- follow the same pattern.

However, looking at the existing codebase pattern more carefully: the `BBjWorkspaceManager` receives params via its `initializeWorkspace` method and stores settings. A simpler approach is to add a static/shared config object.

**Simplest approach:** Add a module-level config in `bbj-validator.ts`:

```typescript
// Configuration for type resolution warnings
let typeResolutionWarningsEnabled = true;

export function setTypeResolutionWarnings(enabled: boolean): void {
    typeResolutionWarningsEnabled = enabled;
}
```

Then in each warning check (`checkCastTypeResolvable`, `checkUsedClassExists`, `checkUnresolvableSuperAccess`), add at the top:

```typescript
if (!typeResolutionWarningsEnabled) return;
```

Call `setTypeResolutionWarnings()` from `extension.ts` or from `BBjWorkspaceManager.initializeWorkspace()` after reading the setting from initializationOptions.

In `extension.ts`, after client starts and connection is ready, or more simply: the BBjWorkspaceManager already has access to params. Add the call in the workspace manager's `initializeWorkspace` method:

```typescript
import { setTypeResolutionWarnings } from './bbj-validator.js';

// In initializeWorkspace, after reading other params:
const typeResWarnings = params.initializationOptions?.typeResolutionWarnings;
if (typeResWarnings === false) {
    setTypeResolutionWarnings(false);
}
```

Alternatively, if the workspace manager doesn't import from validator, call `setTypeResolutionWarnings` from `main.ts` or wherever the language server processes initialization params. Follow the existing pattern used for `home` and `classpath`.

Guard each of the three warning-emitting validation methods with the check:
- `checkCastTypeResolvable` (Plan 01)
- `checkUsedClassExists` -- only the warning parts, not any error-level checks
- `checkUnresolvableSuperAccess` (Plan 02)
  </action>
  <verify>Run `npm test` from `bbj-vscode/` -- all tests pass. Grep package.json for 'typeResolution' to confirm setting exists. Grep bbj-validator.ts for 'typeResolutionWarningsEnabled' to confirm the guard is in place.</verify>
  <done>Workspace setting `bbj.typeResolution.warnings` exists in package.json, defaults to true. When set to false, all type resolution warning diagnostics are suppressed. The setting is passed from extension.ts to the language server and read by the validator.</done>
</task>

</tasks>

<verification>
1. `cd bbj-vscode && npm test` -- all tests pass (0 failures)
2. `bbj.typeResolution.warnings` appears in package.json contributes.configuration
3. `bbj-validator.ts` checks the setting before emitting any type resolution warning
4. Setting defaults to `true` (warnings enabled)
</verification>

<success_criteria>
- `bbj.typeResolution.warnings` setting appears in VS Code settings UI
- When set to false, CAST/USE/super warnings are suppressed
- When true (default), all warnings work normally
- All existing tests pass (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/25-type-resolution-crash-fixes/25-04-SUMMARY.md`
</output>
