---
phase: 40-parser-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-vscode/test/parser.test.ts
autonomous: true

must_haves:
  truths:
    - "Class field declarations like stepXYZ! parse without error"
    - "Structure view shows fields starting with step at correct nesting level"
    - "No false parsing errors on valid BBj class definitions containing step* field names"
  artifacts:
    - path: "bbj-vscode/test/parser.test.ts"
      provides: "Test case verifying stepXYZ field parsing"
      min_lines: 10
      contains: "stepXYZ"
  key_links:
    - from: "bbj-vscode/test/parser.test.ts"
      to: "bbj-vscode/src/language/bbj-token-builder.ts"
      via: "test invokes parser which uses token builder LONGER_ALT config"
      pattern: "stepXYZ.*field.*protected"
---

<objective>
Verify and ensure that field names starting with `step` (like `stepXYZ!`) parse correctly in BBj class definitions.

Purpose: Close GitHub issue #368 where field names starting with "step" keyword prefix caused parsing failures. The LONGER_ALT mechanism from Phase 24 should already handle this, but verification is needed.

Output: Test coverage proving step-prefixed identifiers work in field declarations.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior work on keyword/identifier disambiguation
@.planning/phases/24-grammar-parsing-fixes/24-01-SUMMARY.md

# Current token builder implementation
@bbj-vscode/src/language/bbj-token-builder.ts

# Existing parser tests
@bbj-vscode/test/parser.test.ts
@bbj-vscode/test/classes.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify STEP LONGER_ALT and add test case</name>
  <files>
    bbj-vscode/test/parser.test.ts
  </files>
  <action>
Verify that STEP keyword already has LONGER_ALT configuration (it should, based on Phase 24's implementation that applies LONGER_ALT to all uppercase keyword tokens).

Add test case to parser.test.ts verifying that field names starting with "step" parse correctly:

```typescript
test('Field names starting with step keyword parse correctly (PARSE-01)', async () => {
    const program = await parse(`
        class public A
            field protected BBjStaticText stepXYZ!

            method public BBjString test()
            methodend
        classend

        class public B extends A
        classend
    `)
    expectNoParserLexerErrors(program)
})
```

This test exercises the exact code from issue #368. Place it in the "Parser Tests" describe block near other keyword-prefix tests from Phase 24.

Why this approach: Phase 24 already implemented LONGER_ALT for ALL keyword tokens including STEP. The token builder code at lines 39-49 applies LONGER_ALT to any token matching pattern `/[A-Z]+(?!_)/` that's not a terminal, not excluded, and has no LINE_BREAKS. STEP matches this pattern. The test verifies the fix is working.

If the test FAILS (indicating STEP doesn't have LONGER_ALT), investigate why STEP isn't being caught by the token builder pattern and add explicit handling if needed. However, based on the code review, it should already work.
  </action>
  <verify>
Run test suite: `cd bbj-vscode && npm test -- --run parser.test.ts`

Verify the new "PARSE-01" test passes without parser/lexer errors.
  </verify>
  <done>
Test case exists proving stepXYZ field names parse correctly in class definitions. Test passes without modification to token builder (confirming LONGER_ALT already handles STEP).
  </done>
</task>

</tasks>

<verification>
1. Run full test suite: `cd bbj-vscode && npm test -- --run`
2. All tests pass including new PARSE-01 test
3. Test output shows 0 parser errors and 0 lexer errors for step-prefixed field names
4. Issue #368 code example parses without errors
</verification>

<success_criteria>
- [ ] Test case added for PARSE-01 (step-prefixed field names)
- [ ] Test passes proving stepXYZ! field parses correctly
- [ ] No modifications needed to bbj-token-builder.ts (LONGER_ALT already applied)
- [ ] Full test suite passes
- [ ] GitHub issue #368 example code verified working
</success_criteria>

<output>
After completion, create `.planning/phases/40-parser-fix/40-01-SUMMARY.md` documenting:
- Confirmation that Phase 24's LONGER_ALT already handles STEP keyword
- Test coverage added for step-prefixed field names
- PARSE-01 requirement complete
</output>
