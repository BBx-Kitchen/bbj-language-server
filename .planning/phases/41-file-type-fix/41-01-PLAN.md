---
phase: 41-file-type-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-vscode/package.json
  - bbj-vscode/langium-config.json
  - bbj-intellij/src/main/resources/META-INF/plugin.xml
autonomous: false

must_haves:
  truths:
    - ".bbl files do not trigger BBj language server diagnostics"
    - ".bbl files do not provide BBj code completion"
    - ".bbj, .bbx, .src files continue to work as BBj source files"
  artifacts:
    - path: "bbj-vscode/package.json"
      provides: "VS Code language registration without .bbl"
      contains: '".bbj"'
      not_contains: '".bbl"'
    - path: "bbj-vscode/langium-config.json"
      provides: "Langium file extension config without .bbl"
      contains: '".bbj"'
      not_contains: '".bbl"'
    - path: "bbj-intellij/src/main/resources/META-INF/plugin.xml"
      provides: "IntelliJ file type registration without .bbl"
      contains: 'extensions="bbj'
      not_contains: 'bbl'
  key_links:
    - from: "bbj-vscode/package.json"
      to: "VS Code language server activation"
      via: "contributes.languages[].extensions"
      pattern: '"extensions":\s*\['
    - from: "bbj-vscode/langium-config.json"
      to: "Langium parser activation"
      via: "languages[].fileExtensions"
      pattern: '"fileExtensions":\s*\['
    - from: "bbj-intellij/src/main/resources/META-INF/plugin.xml"
      to: "IntelliJ file type recognition"
      via: "fileType extensions attribute"
      pattern: 'extensions="[^"]*"'
---

<objective>
Remove `.bbl` extension from BBj source file type registration in both VS Code and IntelliJ.

Purpose: BBj library files (.bbl) should not trigger language server features (diagnostics, completion, hover, etc.). They are binary/compiled artifacts, not source code files that benefit from IDE intelligence.

Output: Updated file type registrations excluding .bbl while preserving .bbj, .bbx, .bbjt, .src support
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@bbj-vscode/package.json
@bbj-vscode/langium-config.json
@bbj-intellij/src/main/resources/META-INF/plugin.xml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove .bbl from VS Code extension registration</name>
  <files>
    bbj-vscode/package.json
    bbj-vscode/langium-config.json
  </files>
  <action>
Remove `.bbl` from BBj language file extension lists in VS Code extension.

**In bbj-vscode/package.json:**
- Locate `contributes.languages[0].extensions` array (currently: `[".bbj", ".bbl", ".bbjt", ".src", ".bbx"]`)
- Remove `".bbl"` from the array
- Result: `[".bbj", ".bbjt", ".src", ".bbx"]`

**In bbj-vscode/langium-config.json:**
- Locate `languages[0].fileExtensions` array (currently: `[".bbj", ".bbl", ".bbjt"]`)
- Remove `".bbl"` from the array
- Result: `[".bbj", ".bbjt"]`

**WHY these files:**
- package.json controls VS Code's language activation (when to start language server)
- langium-config.json controls Langium parser file matching (what files to parse)
- Both must exclude .bbl to prevent language features on library files

**DO NOT:**
- Remove other extensions (.bbj, .bbx, .bbjt, .src) - these are valid BBj source files
- Modify any other language registration properties
- Touch grammar or menu configurations
  </action>
  <verify>
Verify .bbl removed from extension lists:

```bash
# VS Code package.json should NOT contain .bbl in extensions array
grep -A 5 '"extensions"' bbj-vscode/package.json | grep -v '\.bbl'

# Langium config should NOT contain .bbl in fileExtensions
grep -A 3 '"fileExtensions"' bbj-vscode/langium-config.json | grep -v '\.bbl'

# Both files should still contain .bbj
grep '\.bbj' bbj-vscode/package.json
grep '\.bbj' bbj-vscode/langium-config.json
```
  </verify>
  <done>
- bbj-vscode/package.json extensions array contains `.bbj`, `.bbjt`, `.src`, `.bbx` but NOT `.bbl`
- bbj-vscode/langium-config.json fileExtensions array contains `.bbj`, `.bbjt` but NOT `.bbl`
- No other language configuration properties modified
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove .bbl from IntelliJ file type registration</name>
  <files>
    bbj-intellij/src/main/resources/META-INF/plugin.xml
  </files>
  <action>
Remove `bbl` from BBj file type extension list in IntelliJ plugin.

**In bbj-intellij/src/main/resources/META-INF/plugin.xml:**
- Locate `<fileType>` element with `name="BBj"` (around line 78)
- Find `extensions` attribute (currently: `extensions="bbj;bbl;bbjt;src;bbx"`)
- Remove `bbl;` from the semicolon-delimited list
- Result: `extensions="bbj;bbjt;src;bbx"`

**WHY this file:**
- plugin.xml controls IntelliJ's file type recognition and language server mapping
- The `extensions` attribute determines which files trigger BBj language features
- Must exclude .bbl to prevent language server activation on library files

**DO NOT:**
- Remove other extensions (bbj, bbjt, src, bbx) - these are valid BBj source files
- Modify the `implementationClass`, `language`, or other fileType attributes
- Touch any other extension points or actions
  </action>
  <verify>
Verify .bbl removed from IntelliJ file type:

```bash
# plugin.xml fileType extensions should NOT contain 'bbl'
grep '<fileType' bbj-intellij/src/main/resources/META-INF/plugin.xml | grep 'extensions=' | grep -v 'bbl'

# Should still contain 'bbj' extension
grep '<fileType' bbj-intellij/src/main/resources/META-INF/plugin.xml | grep 'bbj'
```
  </verify>
  <done>
- plugin.xml fileType extensions attribute contains `bbj;bbjt;src;bbx` but NOT `bbl`
- All other fileType attributes unchanged
- XML remains valid
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
File type registration changes for both VS Code and IntelliJ - .bbl files excluded from BBj language features.
  </what-built>
  <how-to-verify>
**Test in VS Code:**

1. Open a .bbl file (if available in your workspace)
2. Verify: No BBj diagnostics appear (no red squiggles, no errors)
3. Verify: Code completion (Ctrl+Space) does NOT offer BBj-specific suggestions
4. Verify: File is treated as plain text (no syntax highlighting)

5. Open a .bbj file (any BBj source file)
6. Verify: BBj diagnostics still work (syntax errors show)
7. Verify: Code completion still offers BBj keywords and suggestions
8. Verify: Syntax highlighting still works

**Test in IntelliJ (if available):**

1. Open a .bbl file
2. Verify: No BBj language features active (no diagnostics, no completion)

3. Open a .bbj file
4. Verify: BBj language features still work normally

**If no .bbl files available:**
- Create a test file named `test.bbl` with BBj syntax
- Confirm it's treated as plain text (no language features)
- Rename to `test.bbj` and confirm language features activate

**Expected outcome:**
- .bbl files: Plain text, no language server features
- .bbj/.bbx/.src files: Full BBj language support (diagnostics, completion, highlighting)
  </how-to-verify>
  <resume-signal>
Type "approved" if verification passed, or describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
1. **Extension lists updated:**
   - VS Code package.json: `.bbl` removed from extensions array
   - Langium config: `.bbl` removed from fileExtensions array
   - IntelliJ plugin.xml: `bbl` removed from extensions attribute

2. **Valid extensions preserved:**
   - All files still register: `.bbj`, `.bbx`, `.src` (VS Code + IntelliJ)
   - All files still register: `.bbjt` (VS Code + Langium)

3. **Functional verification:**
   - .bbl files: No diagnostics, no completion, plain text treatment
   - .bbj files: Full language features working
</verification>

<success_criteria>
- `.bbl` extension removed from VS Code language registration (package.json)
- `.bbl` extension removed from Langium parser config (langium-config.json)
- `bbl` extension removed from IntelliJ file type registration (plugin.xml)
- `.bbj`, `.bbx`, `.bbjt`, `.src` extensions continue working as BBj source files
- Human verification confirms .bbl files no longer trigger language server features
- GitHub issue #369 can be closed as resolved
</success_criteria>

<output>
After completion, create `.planning/phases/41-file-type-fix/41-01-SUMMARY.md`
</output>
