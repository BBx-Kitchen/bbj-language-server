---
phase: 07-brand-icons
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-intellij/src/main/resources/icons/bbj.svg
  - bbj-intellij/src/main/resources/icons/bbj_dark.svg
  - bbj-intellij/src/main/resources/icons/bbj-config.svg
  - bbj-intellij/src/main/resources/icons/bbj-config_dark.svg
  - bbj-intellij/src/main/resources/icons/run-gui.svg
  - bbj-intellij/src/main/resources/icons/run-gui_dark.svg
  - bbj-intellij/src/main/resources/icons/run-bui.svg
  - bbj-intellij/src/main/resources/icons/run-bui_dark.svg
  - bbj-intellij/src/main/resources/icons/run-dwc.svg
  - bbj-intellij/src/main/resources/icons/run-dwc_dark.svg
  - bbj-intellij/src/main/resources/META-INF/pluginIcon.svg
  - bbj-intellij/src/main/resources/META-INF/pluginIcon_dark.svg
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/BbxConfigFileType.java
  - bbj-intellij/src/main/resources/META-INF/plugin.xml
autonomous: true

must_haves:
  truths:
    - "Opening a .bbj/.bbl/.bbjt/.src file shows the BBj brand B-logo icon (not generic blue B) in editor tab and project tree"
    - "Opening a .bbx config file shows the gear config icon in editor tab and project tree"
    - "Settings > Plugins shows the BBj brand icon for this plugin"
    - "BbjIcons.RUN_GUI, RUN_BUI, and RUN_DWC constants are defined and loadable (ready for Phase 8 wiring)"
    - "All icons have both light and dark variants that IntelliJ auto-selects based on theme"
  artifacts:
    - path: "bbj-intellij/src/main/resources/icons/bbj.svg"
      provides: "BBj file icon (light theme) - brand B-logo at 16x16"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/icons/bbj_dark.svg"
      provides: "BBj file icon (dark theme) - brand B-logo at 16x16"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/icons/bbj-config.svg"
      provides: "BBj config icon (light theme) - gear at 16x16"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/icons/bbj-config_dark.svg"
      provides: "BBj config icon (dark theme) - gear at 16x16"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/icons/run-gui.svg"
      provides: "Run GUI icon (light theme) - play triangle at 16x16"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/icons/run-gui_dark.svg"
      provides: "Run GUI icon (dark theme) - play triangle at 16x16"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/icons/run-bui.svg"
      provides: "Run BUI icon (light theme) - browser at 16x16"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/icons/run-bui_dark.svg"
      provides: "Run BUI icon (dark theme) - browser at 16x16"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/icons/run-dwc.svg"
      provides: "Run DWC icon (light theme) - chrome at 16x16"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/icons/run-dwc_dark.svg"
      provides: "Run DWC icon (dark theme) - chrome at 16x16"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/META-INF/pluginIcon.svg"
      provides: "Plugin marketplace icon (light) - BBj brand at 40x40"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/resources/META-INF/pluginIcon_dark.svg"
      provides: "Plugin marketplace icon (dark) - BBj brand at 40x40"
      contains: "viewBox"
    - path: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java"
      provides: "Icon constants for CONFIG, RUN_GUI, RUN_BUI, RUN_DWC"
      exports: ["CONFIG", "RUN_GUI", "RUN_BUI", "RUN_DWC"]
    - path: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbxConfigFileType.java"
      provides: "FileType for .bbx files with config icon"
      exports: ["INSTANCE"]
  key_links:
    - from: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java"
      to: "/icons/bbj.svg"
      via: "IconLoader.getIcon"
      pattern: "IconLoader\\.getIcon.*icons/bbj\\.svg"
    - from: "bbj-intellij/src/main/java/com/basis/bbj/intellij/BbxConfigFileType.java"
      to: "BbjIcons.CONFIG"
      via: "getIcon() return"
      pattern: "BbjIcons\\.CONFIG"
    - from: "bbj-intellij/src/main/resources/META-INF/plugin.xml"
      to: "BbxConfigFileType"
      via: "fileType registration"
      pattern: "implementationClass.*BbxConfigFileType"
---

<objective>
Convert all VSCode brand icons to IntelliJ format and register them for file types, run actions, and plugin listing.

Purpose: BBj files, config files, and the plugin itself display recognizable brand icons in both light and dark IntelliJ themes, creating visual consistency with the VSCode extension and professional presentation in the JetBrains marketplace.

Output: 12 SVG icon files (6 light/dark pairs), updated BbjIcons.java with new constants, new BbxConfigFileType for .bbx, and updated plugin.xml registration.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java
@bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjFileType.java
@bbj-intellij/src/main/resources/META-INF/plugin.xml
@bbj-vscode/images/bbj-file-light.svg
@bbj-vscode/images/bbj-file-dark.svg
@bbj-vscode/images/bbj-config-light.svg
@bbj-vscode/images/bbj-config-dark.svg
@bbj-vscode/images/run-gui-light.svg
@bbj-vscode/images/run-gui-dark.svg
@bbj-vscode/images/run-bui-light.svg
@bbj-vscode/images/run-bui-dark.svg
@bbj-vscode/images/run-dwc-light.svg
@bbj-vscode/images/run-dwc-dark.svg
@bbj-intellij/src/main/resources/META-INF/pluginIcon.svg
@bbj-intellij/src/main/resources/icons/bbj.svg
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert VSCode SVGs to IntelliJ icon format</name>
  <files>
    bbj-intellij/src/main/resources/icons/bbj.svg
    bbj-intellij/src/main/resources/icons/bbj_dark.svg
    bbj-intellij/src/main/resources/icons/bbj-config.svg
    bbj-intellij/src/main/resources/icons/bbj-config_dark.svg
    bbj-intellij/src/main/resources/icons/run-gui.svg
    bbj-intellij/src/main/resources/icons/run-gui_dark.svg
    bbj-intellij/src/main/resources/icons/run-bui.svg
    bbj-intellij/src/main/resources/icons/run-bui_dark.svg
    bbj-intellij/src/main/resources/icons/run-dwc.svg
    bbj-intellij/src/main/resources/icons/run-dwc_dark.svg
    bbj-intellij/src/main/resources/META-INF/pluginIcon.svg
    bbj-intellij/src/main/resources/META-INF/pluginIcon_dark.svg
  </files>
  <action>
    Convert all VSCode source SVGs from `bbj-vscode/images/` to IntelliJ-compatible SVGs. Apply these transformations:

    **BBj file icon (bbj.svg / bbj_dark.svg) -- from bbj-file-light.svg / bbj-file-dark.svg:**
    - Source is 300pt x 300pt with complex path data (the BBj "B" logo in a rounded square)
    - Change viewBox to "0 0 16 16", width="16" height="16"
    - Keep the `<g transform="translate(0,300) scale(0.1,-0.1)">` and path data EXACTLY as-is -- IntelliJ's SVG renderer handles the viewBox scaling
    - Actually, the 300pt coordinate system with the transform won't scale cleanly to 16x16 viewport. Instead: set `viewBox="0 0 3000 3000"` (matching the original coordinate space since 300pt * 10 = 3000 units), `width="16" height="16"`, and adjust the transform to `translate(0,3000) scale(1,-1)` so the path coordinates map directly without the 0.1 scale factor. This preserves the exact path data.
    - Light variant (`bbj.svg`): fill="#6E6E6E" (IntelliJ standard dark-on-light)
    - Dark variant (`bbj_dark.svg`): fill="#AFB1B3" (IntelliJ standard light-on-dark)
    - Remove the `<?xml?>` declaration and `<!DOCTYPE>` -- IntelliJ prefers clean SVG without XML prolog
    - Remove `preserveAspectRatio` attribute (IntelliJ handles this)

    **BBj config icon (bbj-config.svg / bbj-config_dark.svg) -- from bbj-config-light.svg / bbj-config-dark.svg:**
    - Source is 24x24 stroke-based gear icon (Tabler icon)
    - Change viewBox to "0 0 24 24" (keep original), width="16" height="16"
    - Convert from stroke-based to fill-based for IntelliJ compatibility: IntelliJ SVG icons render best with fills, not strokes. Set stroke="none" and convert the gear path to a filled path. Alternatively, keep stroke-based but set stroke-width="2" and appropriate stroke color.
    - Actually, IntelliJ CAN render stroke-based SVGs. Keep the stroke approach but adapt colors:
    - Light variant (`bbj-config.svg`): stroke="#6E6E6E", stroke-width="2", fill="none"
    - Dark variant (`bbj-config_dark.svg`): stroke="#AFB1B3", stroke-width="2", fill="none"
    - Remove `class` attribute (IntelliJ ignores CSS classes)
    - Keep the path data and circle element exactly as-is

    **Run GUI icon (run-gui.svg / run-gui_dark.svg) -- from run-gui-light.svg / run-gui-dark.svg:**
    - Source is 24x24 stroke-based play triangle (Tabler brand-google-play icon)
    - Change width="16" height="16", keep viewBox="0 0 24 24"
    - Light variant (`run-gui.svg`): stroke="#6E6E6E", stroke-width="2", fill="none"
    - Dark variant (`run-gui_dark.svg`): stroke="#AFB1B3", stroke-width="2", fill="none"
    - Remove `class` attribute
    - Keep path, line elements exactly as-is

    **Run BUI icon (run-bui.svg / run-bui_dark.svg) -- from run-bui-light.svg / run-bui-dark.svg:**
    - Source is 24x24 stroke-based browser icon (Tabler browser icon)
    - Change width="16" height="16", keep viewBox="0 0 24 24"
    - Light variant (`run-bui.svg`): stroke="#6E6E6E", stroke-width="2", fill="none"
    - Dark variant (`run-bui_dark.svg`): stroke="#AFB1B3", stroke-width="2", fill="none"
    - Remove `class` attribute
    - Keep rect, line elements exactly as-is

    **Run DWC icon (run-dwc.svg / run-dwc_dark.svg) -- from run-dwc-light.svg / run-dwc-dark.svg:**
    - Source is 24x24 stroke-based chrome icon (Tabler brand-chrome icon)
    - Change width="16" height="16", keep viewBox="0 0 24 24"
    - Light variant (`run-dwc.svg`): stroke="#6E6E6E", stroke-width="2", fill="none"
    - Dark variant (`run-dwc_dark.svg`): stroke="#AFB1B3", stroke-width="2", fill="none"
    - Remove `class` attribute
    - Keep circle, path elements exactly as-is

    **Plugin marketplace icon (pluginIcon.svg / pluginIcon_dark.svg):**
    - Replace the current placeholder (blue rect + "BBj" text) with the real BBj B-logo
    - Use the same path data from bbj-file-light.svg (the rounded-square B logo)
    - Set viewBox="0 0 3000 3000", width="40" height="40"
    - Use same transform approach as the file icon
    - Light variant (`pluginIcon.svg`): fill="#6E6E6E"
    - Dark variant (`pluginIcon_dark.svg`): fill="#AFB1B3"

    IMPORTANT naming convention: IntelliJ auto-discovers dark variants by `_dark.svg` suffix (underscore, not hyphen). The base filename (without `_dark`) is what IconLoader references. IntelliJ automatically loads the `_dark` variant when the IDE is in dark theme.
  </action>
  <verify>
    All 12 SVG files exist and are valid:
    ```
    ls -la bbj-intellij/src/main/resources/icons/bbj.svg
    ls -la bbj-intellij/src/main/resources/icons/bbj_dark.svg
    ls -la bbj-intellij/src/main/resources/icons/bbj-config.svg
    ls -la bbj-intellij/src/main/resources/icons/bbj-config_dark.svg
    ls -la bbj-intellij/src/main/resources/icons/run-gui.svg
    ls -la bbj-intellij/src/main/resources/icons/run-gui_dark.svg
    ls -la bbj-intellij/src/main/resources/icons/run-bui.svg
    ls -la bbj-intellij/src/main/resources/icons/run-bui_dark.svg
    ls -la bbj-intellij/src/main/resources/icons/run-dwc.svg
    ls -la bbj-intellij/src/main/resources/icons/run-dwc_dark.svg
    ls -la bbj-intellij/src/main/resources/META-INF/pluginIcon.svg
    ls -la bbj-intellij/src/main/resources/META-INF/pluginIcon_dark.svg
    ```
    Each SVG file contains a valid `<svg` element with correct width/height.
    Grep for `width="16"` in icon files and `width="40"` in pluginIcon files.
    No SVG file contains `<?xml` declaration or `<!DOCTYPE`.
    Light variants contain `#6E6E6E`, dark variants contain `#AFB1B3`.
  </verify>
  <done>
    12 SVG files exist: 5 light/dark icon pairs (16x16) + 1 light/dark plugin icon pair (40x40).
    All use IntelliJ color conventions (#6E6E6E light, #AFB1B3 dark).
    All use IntelliJ naming convention (base.svg + base_dark.svg).
    BBj file icons use the real brand B-logo path data from VSCode source.
  </done>
</task>

<task type="auto">
  <name>Task 2: Register icons and .bbx file type in Java and plugin.xml</name>
  <files>
    bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java
    bbj-intellij/src/main/java/com/basis/bbj/intellij/BbxConfigFileType.java
    bbj-intellij/src/main/resources/META-INF/plugin.xml
  </files>
  <action>
    **Update BbjIcons.java** -- add new icon constants after the existing ones:
    ```java
    Icon CONFIG = IconLoader.getIcon("/icons/bbj-config.svg", BbjIcons.class);
    Icon RUN_GUI = IconLoader.getIcon("/icons/run-gui.svg", BbjIcons.class);
    Icon RUN_BUI = IconLoader.getIcon("/icons/run-bui.svg", BbjIcons.class);
    Icon RUN_DWC = IconLoader.getIcon("/icons/run-dwc.svg", BbjIcons.class);
    ```
    Note: Only reference the base filename (no `_dark`). IntelliJ's IconLoader automatically discovers and uses the `_dark.svg` variant when in dark theme. The existing FILE icon (`/icons/bbj.svg`) already points to the right file -- its content was replaced in Task 1 with the brand logo. The dark variant `bbj_dark.svg` will be auto-discovered.

    **Create BbxConfigFileType.java** -- new file type for .bbx config files:
    ```java
    package com.basis.bbj.intellij;

    import com.intellij.openapi.fileTypes.LanguageFileType;
    import org.jetbrains.annotations.NotNull;
    import javax.swing.Icon;

    public final class BbxConfigFileType extends LanguageFileType {
        public static final BbxConfigFileType INSTANCE = new BbxConfigFileType();

        private BbxConfigFileType() {
            super(BbjLanguage.INSTANCE);
        }

        @NotNull
        @Override
        public String getName() {
            return "BBx Config";
        }

        @NotNull
        @Override
        public String getDescription() {
            return "BBx configuration file";
        }

        @NotNull
        @Override
        public String getDefaultExtension() {
            return "bbx";
        }

        @Override
        public Icon getIcon() {
            return BbjIcons.CONFIG;
        }
    }
    ```
    Use `BbjLanguage.INSTANCE` as the language (BBx config files share BBj language features -- they use the same syntax family and the TextMate bundle already maps .bbx to a BBj-related grammar). This is the simplest approach that works. If this causes issues with language mapping, a separate BbxConfigLanguage class could be created later, but it's unnecessary for just icon display.

    **Update plugin.xml** -- add the .bbx file type registration. Add this AFTER the existing BBj fileType element:
    ```xml
    <fileType
        name="BBx Config"
        implementationClass="com.basis.bbj.intellij.BbxConfigFileType"
        fieldName="INSTANCE"
        language="BBj"
        extensions="bbx"/>
    ```

    Also add the LSP language mapping for BBx Config so the language server handles .bbx files:
    ```xml
    <languageMapping language="BBj"
                     serverId="bbjLanguageServer"
                     languageId="bbx"
                     fileType="BBx Config"/>
    ```
    Wait -- the existing languageMapping uses `language="BBj"` and `languageId="bbj"`. Since BbxConfigFileType uses BbjLanguage.INSTANCE (which has language ID "BBj"), the existing mapping should already cover .bbx files. The fileType registration with `language="BBj"` is enough. Do NOT add a duplicate languageMapping; the existing one covers all files with language="BBj".

    Actually, check the existing LSP4IJ mapping carefully. The `languageMapping` maps the IntelliJ language "BBj" to the LSP language ID "bbj". But .bbx files might need language ID "bbx" for the language server. The TextMate bundle maps .bbx to scope "source.bbx" and language "BBx" (capital X). This could be a complication.

    Simplest approach that works: Register BbxConfigFileType with `language="BBj"` in plugin.xml. The language server handles .bbx files via file extension, not language ID. The TextMate highlighting for .bbx comes from the bundle provider which is already registered. If the language server needs the correct languageId for .bbx files, add a second languageMapping:
    ```xml
    <languageMapping language="BBj"
                     serverId="bbjLanguageServer"
                     languageId="bbx"
                     fileType="BBx Config"/>
    ```
    This tells LSP4IJ: for files of type "BBx Config", send languageId "bbx" to the server. This is separate from the existing mapping which sends "bbj" for regular BBj files.
  </action>
  <verify>
    Run the Gradle build to confirm compilation:
    ```
    cd bbj-intellij && ./gradlew build
    ```
    Build succeeds with no errors.
    Grep BbjIcons.java for CONFIG, RUN_GUI, RUN_BUI, RUN_DWC constants.
    Grep plugin.xml for "BBx Config" and "BbxConfigFileType".
    BbxConfigFileType.java exists and compiles.
  </verify>
  <done>
    BbjIcons.java has CONFIG, RUN_GUI, RUN_BUI, RUN_DWC constants pointing to correct SVG paths.
    BbxConfigFileType.java exists, returns "BBx Config" name, "bbx" extension, and BbjIcons.CONFIG icon.
    plugin.xml registers BbxConfigFileType for .bbx extension.
    `./gradlew build` succeeds with no compilation errors.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    All brand icons converted from VSCode format to IntelliJ format, file type icons registered for .bbj/.bbl/.bbjt/.src and .bbx files, plugin marketplace icon replaced with real brand logo, and run action icon constants ready for Phase 8.
  </what-built>
  <how-to-verify>
    Run the plugin in a sandbox IDE:
    ```
    cd bbj-intellij && ./gradlew runIde
    ```
    Then verify:
    1. Open or create a .bbj file -- check the editor tab and project tree show the BBj B-logo icon (not the old generic blue B)
    2. Toggle between light and dark theme (Settings > Appearance) -- the icon should adapt (dark icon on light theme, light icon on dark theme)
    3. Open or create a .bbx file -- check it shows the gear/config icon in tab and project tree
    4. Go to Settings > Plugins > Installed > BBj Language Support -- verify the plugin icon shows the BBj brand logo (not the old blue "BBj" text rectangle)
    5. (Run action icons cannot be verified yet -- they will be wired to toolbar buttons in Phase 8)
  </how-to-verify>
  <resume-signal>Type "approved" if icons display correctly, or describe any visual issues</resume-signal>
</task>

</tasks>

<verification>
1. `ls bbj-intellij/src/main/resources/icons/` shows: bbj.svg, bbj_dark.svg, bbj-config.svg, bbj-config_dark.svg, run-gui.svg, run-gui_dark.svg, run-bui.svg, run-bui_dark.svg, run-dwc.svg, run-dwc_dark.svg (plus existing function/variable/keyword/status/toolwindow icons)
2. `ls bbj-intellij/src/main/resources/META-INF/` shows: pluginIcon.svg, pluginIcon_dark.svg, plugin.xml, description.html
3. `grep -c "Icon " bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java` returns 14 (10 existing + 4 new)
4. `./gradlew build` in bbj-intellij succeeds
5. `grep "BBx Config" bbj-intellij/src/main/resources/META-INF/plugin.xml` finds the fileType registration
</verification>

<success_criteria>
- All 6 ICON requirements (ICON-01 through ICON-06) are addressed
- ICON-01: .bbj/.bbl/.bbjt/.src files show brand B-logo icon (light + dark)
- ICON-02: .bbx files show config gear icon (light + dark) via new BbxConfigFileType
- ICON-03: Plugin listing shows brand icon via pluginIcon.svg / pluginIcon_dark.svg
- ICON-04: RUN_GUI icon constant defined and SVG files ready (wiring in Phase 8)
- ICON-05: RUN_BUI icon constant defined and SVG files ready (wiring in Phase 8)
- ICON-06: RUN_DWC icon constant defined and SVG files ready (wiring in Phase 8)
- Gradle build passes with zero compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-brand-icons/07-01-SUMMARY.md`
</output>
