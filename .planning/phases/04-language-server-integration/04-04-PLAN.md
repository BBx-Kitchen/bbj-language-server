---
phase: 04-language-server-integration
plan: 04
type: execute
wave: 4
depends_on: ["04-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All 10 Phase 4 success criteria verified by human"
  artifacts: []
  key_links: []
---

<objective>
Human verification of all Phase 4 features working end-to-end in the running plugin.

Purpose: Language server integration involves process management, UI components, and LSP protocol communication -- all things that need manual verification in the actual IDE.
Output: Confirmation that all 10 success criteria pass, or a list of issues to address.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-language-server-integration/04-CONTEXT.md
@.planning/phases/04-language-server-integration/04-01-SUMMARY.md
@.planning/phases/04-language-server-integration/04-02-SUMMARY.md
@.planning/phases/04-language-server-integration/04-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete language server integration: LSP4IJ wiring, status bar widget, Tools menu restart action, debounced settings restart, tool window with server logs, crash recovery with balloon+banner notifications, log level setting, and clean project shutdown.
  </what-built>
  <how-to-verify>
    Run `./gradlew runIde` from bbj-intellij/ directory to launch the IDE sandbox. Open the ~/tinybbj project (or any project with .bbj files).

    **Test each success criterion:**

    1. **Server starts on BBj file open**: Open a .bbj file. Check status bar (bottom right) -- should show "BBj: Starting" then "BBj: Ready" with green icon. Also check "BBj Language Server" tool window (bottom panel) for log output.

    2. **Diagnostics**: Introduce a syntax error in a .bbj file (e.g., type `IF` without `THEN`). Red underline should appear. Hover over it to see tooltip with error message.

    3. **Code completion**: Type a partial BBj keyword (e.g., `PRI`) and trigger completion (Ctrl+Space). Popup should show BBj keywords, built-in functions, variables. Note whether BBj-specific icons (colored circles) appear for Function/Variable/Keyword items.

    4. **Go-to-definition**: Ctrl+Click (Cmd+Click on macOS) on a variable reference. Should navigate to the variable's declaration.

    5. **Hover**: Hover over a function name. Should show documentation and/or signature information.

    6. **Parameter hints**: Type a function name followed by `(`. Parameter hints should appear showing expected arguments.

    7. **Settings restart**: Open Settings > Languages & Frameworks > BBj. Change the BBj home path or classpath. Click Apply. Status bar should briefly show "BBj: Starting" (restart triggered). Verify the new log level dropdown appears with Error/Warn/Info/Debug options.

    8. **Clean shutdown**: Close the project (File > Close Project). Check system processes (`ps aux | grep node` on macOS/Linux or Task Manager on Windows) -- no orphaned node processes running main.cjs.

    9. **Tools menu restart**: Open a .bbj file. Go to Tools menu. "Restart BBj Language Server" should be visible. Click it. Status bar should show restart sequence. Close the .bbj file (switch to a non-BBj file). Tools menu should NOT show the restart action.

    10. **Crash notification**: To test crash recovery, you can temporarily break the server (rename main.cjs or change node path to invalid). Open a .bbj file. A balloon notification should appear saying the server crashed. An editor banner should appear on the .bbj file. The status bar should show "BBj: Error". Click "Restart" in the balloon or banner to recover.

    Report results: For each criterion, note PASS or FAIL with details on any failures.
  </how-to-verify>
  <resume-signal>Type "approved" if all 10 criteria pass, or describe specific failures for gap closure.</resume-signal>
</task>

</tasks>

<verification>
All 10 Phase 4 success criteria verified by human tester in running IDE sandbox.
</verification>

<success_criteria>
- All 10 success criteria pass
- No zombie Node.js processes after project close
- Status bar widget responsive and accurate
- Crash recovery works as specified (auto-restart once, stop on second)
</success_criteria>

<output>
After completion, create `.planning/phases/04-language-server-integration/04-04-SUMMARY.md`
</output>
