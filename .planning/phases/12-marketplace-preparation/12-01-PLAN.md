---
phase: 12-marketplace-preparation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-intellij/src/main/resources/META-INF/description.html
  - bbj-intellij/src/main/resources/META-INF/LICENSE
  - bbj-intellij/src/main/resources/META-INF/NOTICES
  - bbj-intellij/build.gradle.kts
autonomous: true

must_haves:
  truths:
    - "Plugin description accurately lists all implemented features including run commands and Structure view"
    - "Plugin description mentions shared language server backend with VS Code extension"
    - "MIT License text is included in plugin distribution at META-INF/LICENSE"
    - "NOTICES file documents LSP4IJ (EPL-2.0) and TextMate bundle dependencies"
    - "build.gradle.kts has version 0.1.0, changeNotes with feature list, and pluginVerification configured"
  artifacts:
    - path: "bbj-intellij/src/main/resources/META-INF/description.html"
      provides: "Marketplace listing description with full feature list"
      contains: "Run commands"
    - path: "bbj-intellij/src/main/resources/META-INF/LICENSE"
      provides: "MIT License for plugin distribution"
      contains: "Permission is hereby granted"
    - path: "bbj-intellij/src/main/resources/META-INF/NOTICES"
      provides: "Third-party dependency attributions"
      contains: "LSP4IJ"
    - path: "bbj-intellij/build.gradle.kts"
      provides: "Gradle config with version, changeNotes, pluginVerification"
      contains: "pluginVerification"
  key_links:
    - from: "bbj-intellij/build.gradle.kts"
      to: "bbj-intellij/src/main/resources/META-INF/description.html"
      via: "file read in pluginConfiguration.description"
      pattern: 'description\.html.*readText'
    - from: "bbj-intellij/build.gradle.kts"
      to: "plugin.xml patching"
      via: "pluginConfiguration changeNotes"
      pattern: "changeNotes"
---

<objective>
Prepare all marketplace metadata, licensing, and Gradle configuration for JetBrains Marketplace submission.

Purpose: The plugin needs complete metadata (description, change notes, vendor info), licensing files (MIT LICENSE, NOTICES for third-party deps), and Gradle verification configuration before it can pass Marketplace approval. This plan creates all the assets and configuration needed for a submission-ready plugin.

Output: Updated description.html with full feature list, LICENSE and NOTICES files in META-INF, and build.gradle.kts with version 0.1.0, change notes, and plugin verifier configuration.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-marketplace-preparation/12-CONTEXT.md
@.planning/phases/12-marketplace-preparation/12-RESEARCH.md
@bbj-intellij/build.gradle.kts
@bbj-intellij/src/main/resources/META-INF/plugin.xml
@bbj-intellij/src/main/resources/META-INF/description.html
@LICENSE
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update description.html and create LICENSE + NOTICES files</name>
  <files>
    bbj-intellij/src/main/resources/META-INF/description.html
    bbj-intellij/src/main/resources/META-INF/LICENSE
    bbj-intellij/src/main/resources/META-INF/NOTICES
  </files>
  <action>
    1. Update `description.html` to include the complete, honest feature set. The current description is missing run commands, Structure view, bracket matching, and comment toggling. Match the tone of the VS Code Marketplace listing but be honest about what's actually implemented. The description must:
       - Open with a brief intro paragraph mentioning this is powered by the same Langium-based language server as the VS Code extension (shared backend credibility per CONTEXT.md decisions)
       - List all implemented features: syntax highlighting (BBj and BBx config), real-time diagnostics, code completion (BBj keywords + Java classes), go-to-definition, hover documentation, signature help, Java interop intelligence, run commands (GUI/BUI/DWC), Structure view (document outline), comment toggling (REM), bracket matching
       - Include a Requirements section: Node.js 18+ (auto-downloaded if not found), BBj installation (for run commands and Java class completions)
       - Include links to GitHub repo: https://github.com/BBx-Kitchen/bbj-language-server
       - Use ONLY basic HTML tags: p, ul, li, strong, em, a (no script, style, div, span, h1-h6 - Marketplace strips them)
       - Do NOT include screenshots (per CONTEXT.md: text-only for initial submission)

    2. Create `LICENSE` file in META-INF by copying the repo root LICENSE file content verbatim (MIT License, Copyright 2023 BASIS International Ltd.). This ensures the license is included in the plugin distribution ZIP.

    3. Create `NOTICES` file in META-INF documenting third-party dependencies:
       - LSP4IJ: Copyright Red Hat, Inc., Eclipse Public License 2.0 (EPL-2.0), https://github.com/redhat-developer/lsp4ij
       - TextMate Bundles (bbj.tmLanguage.json, bbx.tmLanguage.json): Copyright 2023 BASIS International Ltd., MIT License, from same repo
       - Langium Language Server (main.cjs bundle): Copyright TypeFox GmbH, MIT License, https://github.com/eclipse-langium/langium
       - Use the structure from RESEARCH.md Pattern 4 (separator lines between entries)
  </action>
  <verify>
    - `cat bbj-intellij/src/main/resources/META-INF/description.html` shows updated feature list with run commands and Structure view
    - `cat bbj-intellij/src/main/resources/META-INF/LICENSE` shows MIT License text
    - `cat bbj-intellij/src/main/resources/META-INF/NOTICES` shows LSP4IJ and other dependency attributions
    - No HTML tags beyond p, ul, li, strong, em, a in description.html
  </verify>
  <done>
    description.html lists all 11+ implemented features, mentions shared VS Code language server backend, and uses only Marketplace-safe HTML tags. LICENSE contains full MIT text. NOTICES documents LSP4IJ (EPL-2.0), TextMate bundles (MIT), and Langium bundle (MIT).
  </done>
</task>

<task type="auto">
  <name>Task 2: Update build.gradle.kts with version, changeNotes, and pluginVerification</name>
  <files>
    bbj-intellij/build.gradle.kts
  </files>
  <action>
    Update `build.gradle.kts` with three changes:

    1. **Version**: Change `version = "0.1.0-alpha"` to `version = "0.1.0"` (per CONTEXT.md: first Marketplace release version is 0.1.0).

    2. **Change Notes**: Add `changeNotes` to the `pluginConfiguration` block with CDATA-wrapped HTML listing implemented features for the initial 0.1.0 release. Format as a bulleted list under an "0.1.0 - Initial Release" heading. Include:
       - Syntax highlighting for BBj and BBx config files
       - Real-time diagnostics powered by Langium language server
       - Code completion for BBj keywords, functions, and Java classes
       - Go-to-definition and hover documentation
       - Signature help for method calls
       - Run BBj programs as GUI, BUI, or DWC from the editor
       - Document outline / Structure view
       - Java interop intelligence for BBjAPI classes
       - Comment toggling and bracket matching
       Do NOT mention future plans, "coming soon", or "planned" features (per RESEARCH.md Pitfall 6).

    3. **Plugin Verification**: Add `pluginVerification` block to the `intellijPlatform` section. Use `recommended()` for IDE selection (automatically aligns with sinceBuild/untilBuild). Do NOT add custom `failureLevel` configuration - let the default handle it. The Gradle plugin 2.x defaults are sufficient.

    4. **Since-build**: Keep `sinceBuild = "242"` (IntelliJ 2024.2+) as-is. The CONTEXT.md says "2024.1+" but the current build already targets 242 (2024.2) and that's the IDE version in the dependencies block. Keep them aligned. Do NOT change the sinceBuild.

    Important: Do NOT add a `signing` block (signing will happen when user is ready to publish, not now). Do NOT modify the existing copy tasks, prepareSandbox, or runIde configuration.
  </action>
  <verify>
    - `grep 'version = "0.1.0"' bbj-intellij/build.gradle.kts` matches (no -alpha suffix)
    - `grep -c 'changeNotes' bbj-intellij/build.gradle.kts` returns at least 1
    - `grep -c 'pluginVerification' bbj-intellij/build.gradle.kts` returns at least 1
    - `grep -c 'recommended' bbj-intellij/build.gradle.kts` returns at least 1
    - `cd bbj-intellij && ./gradlew verifyPluginProjectConfiguration` succeeds (validates plugin.xml + Gradle config alignment)
  </verify>
  <done>
    build.gradle.kts has version "0.1.0", changeNotes with initial release feature list in CDATA HTML, and pluginVerification with recommended() IDE selection. Gradle project configuration validation passes.
  </done>
</task>

</tasks>

<verification>
1. All four files exist and contain expected content:
   - `description.html` - full feature list, shared LS mention, safe HTML only
   - `LICENSE` - MIT License text
   - `NOTICES` - Third-party attributions (LSP4IJ, TextMate, Langium)
   - `build.gradle.kts` - version 0.1.0, changeNotes, pluginVerification
2. `cd bbj-intellij && ./gradlew verifyPluginProjectConfiguration` passes
3. `cd bbj-intellij && ./gradlew buildPlugin` succeeds and produces distribution ZIP
</verification>

<success_criteria>
- Plugin description accurately represents all implemented features
- License and attribution files are in META-INF for distribution inclusion
- Gradle configuration is complete for Marketplace submission (version, change notes, verifier)
- Plugin builds successfully with updated configuration
</success_criteria>

<output>
After completion, create `.planning/phases/12-marketplace-preparation/12-01-SUMMARY.md`
</output>
