---
phase: 42-toolbar-button-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bbj-intellij/src/main/resources/META-INF/plugin.xml
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjCompileAction.java
  - bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java
  - bbj-intellij/src/main/resources/icons/compile.svg
  - bbj-intellij/src/main/resources/icons/compile_dark.svg
autonomous: false

must_haves:
  truths:
    - "Decompile toolbar button does not appear in IntelliJ UI"
    - "Compile button displays with a proper BBj-branded icon"
    - "Compile button only visible when BBj file is open in editor"
    - "Compile button hidden when non-BBj files (e.g., .java, .md) are active"
  artifacts:
    - path: "bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjCompileAction.java"
      provides: "Compile action with proper file visibility"
      min_lines: 50
    - path: "bbj-intellij/src/main/resources/icons/compile.svg"
      provides: "Compile button icon (light theme)"
      min_lines: 1
    - path: "bbj-intellij/src/main/resources/icons/compile_dark.svg"
      provides: "Compile button icon (dark theme)"
      min_lines: 1
  key_links:
    - from: "bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjCompileAction.java"
      to: "BbjRunActionBase pattern"
      via: "update() method with file extension check"
      pattern: "update.*isBbjFile.*getExtension"
    - from: "bbj-intellij/src/main/resources/META-INF/plugin.xml"
      to: "BbjCompileAction"
      via: "action registration with toolbar group"
      pattern: "<action.*bbj\\.compile.*BbjCompileAction"
    - from: "BbjCompileAction"
      to: "BbjIcons.COMPILE"
      via: "icon reference"
      pattern: "BbjIcons\\.COMPILE"
---

<objective>
Ensure Compile and Decompile toolbar buttons follow IntelliJ best practices for file-scoped actions.

Purpose: Close GitHub issues #370 and #354 by removing the Decompile button entirely, giving Compile a proper icon, and ensuring both follow the same visibility pattern as existing run actions (GUI/BUI/DWC).
Output: Compile action with proper icon and BBj-file-only visibility; no Decompile action in plugin.xml or codebase.
</objective>

<execution_context>
@/Users/beff/.claude/get-shit-done/workflows/execute-plan.md
@/Users/beff/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing action patterns
@bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunActionBase.java
@bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjRunGuiAction.java
@bbj-intellij/src/main/resources/META-INF/plugin.xml
@bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Compile action with proper file scoping</name>
  <files>
    bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjCompileAction.java
    bbj-intellij/src/main/java/com/basis/bbj/intellij/BbjIcons.java
    bbj-intellij/src/main/resources/icons/compile.svg
    bbj-intellij/src/main/resources/icons/compile_dark.svg
    bbj-intellij/src/main/resources/META-INF/plugin.xml
  </files>
  <action>
Create BbjCompileAction following the BbjRunActionBase pattern (NOT extending it, since compile doesn't need process execution):

**BbjCompileAction.java:**
- Extend AnAction with icon from BbjIcons.COMPILE
- Implement update() method checking file extension: only enable for .bbj/.bbx/.src files (NOT .bbl per Phase 41)
- Check language server status like BbjRunActionBase does (lines 122-129)
- Set presentation.setEnabledAndVisible(false) when not a BBj file or server not ready
- Implement actionPerformed() to call VS Code command "bbj.compile" via language server custom notification
- Use ActionUpdateThread.BGT for getActionUpdateThread()

**BbjIcons.java:**
- Add COMPILE icon constant: `Icon COMPILE = IconLoader.getIcon("/icons/compile.svg", BbjIcons.class);`

**Compile icons (compile.svg and compile_dark.svg):**
- Create simple SVG icons (16x16) with a document/hammer or build symbol
- Use BASIS blue (#0066CC) for light theme, white (#FFFFFF) for dark theme
- Keep simple and consistent with existing run-*.svg icon style

**plugin.xml:**
- Register bbj.compile action under <actions> section
- Add to MainToolbar group with anchor="before" relative-to-action="RunConfiguration"
- Specify icon="com.basis.bbj.intellij.BbjIcons.COMPILE"
- Do NOT register any Decompile action (requirement TOOL-01)
- Ensure no leftover bbj.decompile action elements exist

Pattern to follow from BbjRunActionBase.update():
```java
boolean isBbjFile = false;
if (file != null) {
    String ext = file.getExtension();
    // Exclude .bbl per Phase 41
    isBbjFile = ext != null && (ext.equals("bbj") || ext.equals("bbx") || ext.equals("src"));
}

boolean serverReady = false;
if (project != null && isBbjFile) {
    BbjServerService service = BbjServerService.getInstance(project);
    com.redhat.devtools.lsp4ij.ServerStatus status = service.getCurrentStatus();
    serverReady = status == com.redhat.devtools.lsp4ij.ServerStatus.started;
}

e.getPresentation().setEnabledAndVisible(project != null && isBbjFile && serverReady);
```

Note: Exclude .bbl extension (it's for library files, not user source code) per Phase 41 requirements.
  </action>
  <verify>
Build IntelliJ plugin:
```bash
cd bbj-intellij && ./gradlew buildPlugin
```

Check icon files exist:
```bash
ls -lh bbj-intellij/src/main/resources/icons/compile*.svg
```

Verify BbjCompileAction follows pattern:
```bash
grep -A 3 "update.*AnActionEvent" bbj-intellij/src/main/java/com/basis/bbj/intellij/actions/BbjCompileAction.java
```

Verify no Decompile references in plugin.xml:
```bash
grep -i decompile bbj-intellij/src/main/resources/META-INF/plugin.xml
```
(Should return no matches)
  </verify>
  <done>
- BbjCompileAction.java created with update() method checking file extensions (.bbj, .bbx, .src only)
- Compile icons (light and dark variants) created as 16x16 SVG files
- BbjIcons.COMPILE constant added
- plugin.xml registers bbj.compile action with icon and toolbar placement
- plugin.xml contains zero references to "decompile" or "Decompile"
- Build succeeds with no compilation errors
  </done>
</task>

<task type="checkpoint:human-verify">
  <name>Task 2: Verify toolbar button behavior</name>
  <files></files>
  <action>
Human verification of Compile button visibility and Decompile button removal.

Test scenarios:
1. Install the built plugin in IntelliJ
2. Open a BBj project
3. Test Compile button visibility across file types
4. Confirm Decompile button completely removed
5. Verify icon quality in both light and dark themes
  </action>
  <verify>
**Compile button visibility:**
- Open a .bbj file → Compile button should appear in toolbar with BBj icon
- Open a .java file → Compile button should disappear
- Open a .md file → Compile button should disappear
- Open a .bbl file → Compile button should disappear (library files excluded)
- Switch back to .bbj file → Compile button should reappear

**Decompile button absence:**
- Search entire toolbar for any "Decompile" action → should not exist
- Right-click in editor → no "Decompile" in context menu

**Icon quality:**
- Compile icon should be visible and properly styled
- Check both light and dark themes → icons should be readable in both

All checks must pass for approval.
  </verify>
  <done>
User confirms:
- Compile button only visible when BBj source file (.bbj, .bbx, .src) is active
- No Decompile button anywhere in UI
- Icon matches style of existing RUN_GUI/RUN_BUI/RUN_DWC icons
- Behavior matches requirements from issues #370 and #354
  </done>
</task>

</tasks>

<verification>
**File-scoped visibility:**
- Compile button appears only for .bbj, .bbx, .src files
- Compile button hidden for .java, .md, .bbl, and other non-BBj files
- Behavior matches existing run actions (GUI/BUI/DWC)

**Icon quality:**
- Compile icon renders cleanly in both light and dark themes
- Icon style consistent with other toolbar actions

**Decompile removal:**
- Zero occurrences of "decompile" in plugin.xml (case-insensitive)
- No Decompile action class exists in codebase
- No Decompile button visible in any IntelliJ UI location
</verification>

<success_criteria>
1. Decompile toolbar button completely removed from IntelliJ UI (TOOL-01)
2. Compile button displays with a proper BBj-branded icon, not a generic placeholder (TOOL-02)
3. Compile button only appears when a BBj source file (.bbj, .bbx, .src) is open in the editor (TOOL-03)
4. Compile button hidden when non-BBj files are active (TOOL-03 continuation)
5. Build succeeds without errors
6. Human verification confirms proper visibility behavior across file types
</success_criteria>

<output>
After completion, create `.planning/phases/42-toolbar-button-polish/42-01-SUMMARY.md`
</output>
